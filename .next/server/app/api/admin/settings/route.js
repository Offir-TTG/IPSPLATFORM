"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/admin/settings/route";
exports.ids = ["app/api/admin/settings/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fsettings%2Froute&page=%2Fapi%2Fadmin%2Fsettings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fsettings%2Froute.ts&appDir=C%3A%5CUsers%5COffirOmer%5CDocuments%5CIPSPlatform%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5COffirOmer%5CDocuments%5CIPSPlatform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fsettings%2Froute&page=%2Fapi%2Fadmin%2Fsettings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fsettings%2Froute.ts&appDir=C%3A%5CUsers%5COffirOmer%5CDocuments%5CIPSPlatform%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5COffirOmer%5CDocuments%5CIPSPlatform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \**************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var C_Users_OffirOmer_Documents_IPSPlatform_src_app_api_admin_settings_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./src/app/api/admin/settings/route.ts */ \"(rsc)/./src/app/api/admin/settings/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/admin/settings/route\",\n        pathname: \"/api/admin/settings\",\n        filename: \"route\",\n        bundlePath: \"app/api/admin/settings/route\"\n    },\n    resolvedPagePath: \"C:\\\\Users\\\\OffirOmer\\\\Documents\\\\IPSPlatform\\\\src\\\\app\\\\api\\\\admin\\\\settings\\\\route.ts\",\n    nextConfigOutput,\n    userland: C_Users_OffirOmer_Documents_IPSPlatform_src_app_api_admin_settings_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/admin/settings/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZhZG1pbiUyRnNldHRpbmdzJTJGcm91dGUmcGFnZT0lMkZhcGklMkZhZG1pbiUyRnNldHRpbmdzJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGYWRtaW4lMkZzZXR0aW5ncyUyRnJvdXRlLnRzJmFwcERpcj1DJTNBJTVDVXNlcnMlNUNPZmZpck9tZXIlNUNEb2N1bWVudHMlNUNJUFNQbGF0Zm9ybSU1Q3NyYyU1Q2FwcCZwYWdlRXh0ZW5zaW9ucz10c3gmcGFnZUV4dGVuc2lvbnM9dHMmcGFnZUV4dGVuc2lvbnM9anN4JnBhZ2VFeHRlbnNpb25zPWpzJnJvb3REaXI9QyUzQSU1Q1VzZXJzJTVDT2ZmaXJPbWVyJTVDRG9jdW1lbnRzJTVDSVBTUGxhdGZvcm0maXNEZXY9dHJ1ZSZ0c2NvbmZpZ1BhdGg9dHNjb25maWcuanNvbiZiYXNlUGF0aD0mYXNzZXRQcmVmaXg9Jm5leHRDb25maWdPdXRwdXQ9JnByZWZlcnJlZFJlZ2lvbj0mbWlkZGxld2FyZUNvbmZpZz1lMzAlM0QhIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7OztBQUFzRztBQUN2QztBQUNjO0FBQ3NDO0FBQ25IO0FBQ0E7QUFDQTtBQUNBLHdCQUF3QixnSEFBbUI7QUFDM0M7QUFDQSxjQUFjLHlFQUFTO0FBQ3ZCO0FBQ0E7QUFDQTtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ0E7QUFDQSxZQUFZO0FBQ1osQ0FBQztBQUNEO0FBQ0E7QUFDQTtBQUNBLFFBQVEsaUVBQWlFO0FBQ3pFO0FBQ0E7QUFDQSxXQUFXLDRFQUFXO0FBQ3RCO0FBQ0E7QUFDQSxLQUFLO0FBQ0w7QUFDdUg7O0FBRXZIIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGFyZW50aW5nLXNjaG9vbC1wbGF0Zm9ybS8/ZTE1YiJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCJDOlxcXFxVc2Vyc1xcXFxPZmZpck9tZXJcXFxcRG9jdW1lbnRzXFxcXElQU1BsYXRmb3JtXFxcXHNyY1xcXFxhcHBcXFxcYXBpXFxcXGFkbWluXFxcXHNldHRpbmdzXFxcXHJvdXRlLnRzXCI7XG4vLyBXZSBpbmplY3QgdGhlIG5leHRDb25maWdPdXRwdXQgaGVyZSBzbyB0aGF0IHdlIGNhbiB1c2UgdGhlbSBpbiB0aGUgcm91dGVcbi8vIG1vZHVsZS5cbmNvbnN0IG5leHRDb25maWdPdXRwdXQgPSBcIlwiXG5jb25zdCByb3V0ZU1vZHVsZSA9IG5ldyBBcHBSb3V0ZVJvdXRlTW9kdWxlKHtcbiAgICBkZWZpbml0aW9uOiB7XG4gICAgICAgIGtpbmQ6IFJvdXRlS2luZC5BUFBfUk9VVEUsXG4gICAgICAgIHBhZ2U6IFwiL2FwaS9hZG1pbi9zZXR0aW5ncy9yb3V0ZVwiLFxuICAgICAgICBwYXRobmFtZTogXCIvYXBpL2FkbWluL3NldHRpbmdzXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9hZG1pbi9zZXR0aW5ncy9yb3V0ZVwiXG4gICAgfSxcbiAgICByZXNvbHZlZFBhZ2VQYXRoOiBcIkM6XFxcXFVzZXJzXFxcXE9mZmlyT21lclxcXFxEb2N1bWVudHNcXFxcSVBTUGxhdGZvcm1cXFxcc3JjXFxcXGFwcFxcXFxhcGlcXFxcYWRtaW5cXFxcc2V0dGluZ3NcXFxccm91dGUudHNcIixcbiAgICBuZXh0Q29uZmlnT3V0cHV0LFxuICAgIHVzZXJsYW5kXG59KTtcbi8vIFB1bGwgb3V0IHRoZSBleHBvcnRzIHRoYXQgd2UgbmVlZCB0byBleHBvc2UgZnJvbSB0aGUgbW9kdWxlLiBUaGlzIHNob3VsZFxuLy8gYmUgZWxpbWluYXRlZCB3aGVuIHdlJ3ZlIG1vdmVkIHRoZSBvdGhlciByb3V0ZXMgdG8gdGhlIG5ldyBmb3JtYXQuIFRoZXNlXG4vLyBhcmUgdXNlZCB0byBob29rIGludG8gdGhlIHJvdXRlLlxuY29uc3QgeyByZXF1ZXN0QXN5bmNTdG9yYWdlLCBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlLCBzZXJ2ZXJIb29rcyB9ID0gcm91dGVNb2R1bGU7XG5jb25zdCBvcmlnaW5hbFBhdGhuYW1lID0gXCIvYXBpL2FkbWluL3NldHRpbmdzL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fsettings%2Froute&page=%2Fapi%2Fadmin%2Fsettings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fsettings%2Froute.ts&appDir=C%3A%5CUsers%5COffirOmer%5CDocuments%5CIPSPlatform%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5COffirOmer%5CDocuments%5CIPSPlatform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./src/app/api/admin/settings/route.ts":
/*!*********************************************!*\
  !*** ./src/app/api/admin/settings/route.ts ***!
  \*********************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   DELETE: () => (/* binding */ DELETE),\n/* harmony export */   GET: () => (/* binding */ GET),\n/* harmony export */   POST: () => (/* binding */ POST),\n/* harmony export */   PUT: () => (/* binding */ PUT)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabase/server */ \"(rsc)/./src/lib/supabase/server.ts\");\n/* harmony import */ var _lib_audit_auditService__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/audit/auditService */ \"(rsc)/./src/lib/audit/auditService.ts\");\n\n\n\n// GET all platform settings\nasync function GET(request) {\n    try {\n        const supabase = await (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__.createClient)();\n        // Check if user is admin\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const { data: userData } = await supabase.from(\"users\").select(\"role\").eq(\"id\", user.id).single();\n        if (!userData || userData.role !== \"admin\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Forbidden\"\n            }, {\n                status: 403\n            });\n        }\n        const { searchParams } = new URL(request.url);\n        const category = searchParams.get(\"category\");\n        let query = supabase.from(\"platform_settings\").select(\"*\").order(\"category\").order(\"label\");\n        if (category) {\n            query = query.eq(\"category\", category);\n        }\n        const { data: settings, error } = await query;\n        if (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: error.message\n            }, {\n                status: 500\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: settings\n        });\n    } catch (error) {\n        console.error(\"Get settings error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Failed to fetch settings\"\n        }, {\n            status: 500\n        });\n    }\n}\n// POST - Create new setting\nasync function POST(request) {\n    try {\n        const supabase = await (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__.createClient)();\n        // Check if user is admin\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const { data: userData } = await supabase.from(\"users\").select(\"role\").eq(\"id\", user.id).single();\n        if (!userData || userData.role !== \"admin\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Forbidden\"\n            }, {\n                status: 403\n            });\n        }\n        const { setting_key, setting_value, setting_type, category, label, description, is_public } = await request.json();\n        if (!setting_key || !setting_value || !setting_type || !category || !label) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Missing required fields\"\n            }, {\n                status: 400\n            });\n        }\n        const { data: setting, error } = await supabase.from(\"platform_settings\").insert({\n            setting_key,\n            setting_value,\n            setting_type,\n            category,\n            label,\n            description,\n            is_public: is_public || false\n        }).select().single();\n        if (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: error.message\n            }, {\n                status: 500\n            });\n        }\n        // Audit log\n        await (0,_lib_audit_auditService__WEBPACK_IMPORTED_MODULE_2__.logAuditEvent)({\n            user_id: user.id,\n            event_type: \"CREATE\",\n            event_category: \"CONFIG\",\n            resource_type: \"platform_setting\",\n            resource_id: setting.id,\n            resource_name: setting_key,\n            action: \"Created platform setting\",\n            description: `Created setting: ${label} (${setting_key})`,\n            new_values: {\n                setting_key,\n                setting_value,\n                setting_type,\n                category,\n                label,\n                is_public\n            },\n            status: \"success\",\n            risk_level: \"medium\",\n            metadata: {\n                category,\n                setting_type\n            }\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            data: setting,\n            message: \"Setting created successfully\"\n        });\n    } catch (error) {\n        console.error(\"Create setting error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Failed to create setting\"\n        }, {\n            status: 500\n        });\n    }\n}\n// PUT - Bulk update settings\nasync function PUT(request) {\n    try {\n        const supabase = await (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__.createClient)();\n        // Check if user is admin\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const { data: userData } = await supabase.from(\"users\").select(\"role\").eq(\"id\", user.id).single();\n        if (!userData || userData.role !== \"admin\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Forbidden\"\n            }, {\n                status: 403\n            });\n        }\n        const { settings } = await request.json();\n        if (!settings || !Array.isArray(settings)) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Invalid request format\"\n            }, {\n                status: 400\n            });\n        }\n        // Get old values for audit\n        const oldSettingsData = await supabase.from(\"platform_settings\").select(\"*\").in(\"setting_key\", settings.map((s)=>s.setting_key));\n        const oldSettings = oldSettingsData.data || [];\n        // Update each setting\n        const updatePromises = settings.map(async (setting)=>{\n            return supabase.from(\"platform_settings\").update({\n                setting_value: setting.setting_value\n            }).eq(\"setting_key\", setting.setting_key).select().single();\n        });\n        const results = await Promise.all(updatePromises);\n        const errors = results.filter((r)=>r.error);\n        if (errors.length > 0) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Failed to update some settings\"\n            }, {\n                status: 500\n            });\n        }\n        // Audit log for each updated setting\n        for (const setting of settings){\n            const oldSetting = oldSettings.find((s)=>s.setting_key === setting.setting_key);\n            if (oldSetting) {\n                await (0,_lib_audit_auditService__WEBPACK_IMPORTED_MODULE_2__.logAuditEvent)({\n                    user_id: user.id,\n                    event_type: \"UPDATE\",\n                    event_category: \"CONFIG\",\n                    resource_type: \"platform_setting\",\n                    resource_id: oldSetting.id,\n                    resource_name: setting.setting_key,\n                    action: \"Updated platform setting\",\n                    description: `Updated setting: ${oldSetting.label} (${setting.setting_key})`,\n                    old_values: {\n                        setting_value: oldSetting.setting_value\n                    },\n                    new_values: {\n                        setting_value: setting.setting_value\n                    },\n                    status: \"success\",\n                    risk_level: \"medium\",\n                    metadata: {\n                        category: oldSetting.category,\n                        setting_type: oldSetting.setting_type\n                    }\n                });\n            }\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: `${settings.length} settings updated successfully`\n        });\n    } catch (error) {\n        console.error(\"Update settings error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Failed to update settings\"\n        }, {\n            status: 500\n        });\n    }\n}\n// DELETE - Delete setting\nasync function DELETE(request) {\n    try {\n        const supabase = await (0,_lib_supabase_server__WEBPACK_IMPORTED_MODULE_1__.createClient)();\n        // Check if user is admin\n        const { data: { user } } = await supabase.auth.getUser();\n        if (!user) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Unauthorized\"\n            }, {\n                status: 401\n            });\n        }\n        const { data: userData } = await supabase.from(\"users\").select(\"role\").eq(\"id\", user.id).single();\n        if (!userData || userData.role !== \"admin\") {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Forbidden\"\n            }, {\n                status: 403\n            });\n        }\n        const { searchParams } = new URL(request.url);\n        const settingKey = searchParams.get(\"key\");\n        if (!settingKey) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: \"Setting key is required\"\n            }, {\n                status: 400\n            });\n        }\n        // Get setting for audit before deleting\n        const { data: setting } = await supabase.from(\"platform_settings\").select(\"*\").eq(\"setting_key\", settingKey).single();\n        const { error } = await supabase.from(\"platform_settings\").delete().eq(\"setting_key\", settingKey);\n        if (error) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                success: false,\n                error: error.message\n            }, {\n                status: 500\n            });\n        }\n        // Audit log\n        if (setting) {\n            await (0,_lib_audit_auditService__WEBPACK_IMPORTED_MODULE_2__.logAuditEvent)({\n                user_id: user.id,\n                event_type: \"DELETE\",\n                event_category: \"CONFIG\",\n                resource_type: \"platform_setting\",\n                resource_id: setting.id,\n                resource_name: settingKey,\n                action: \"Deleted platform setting\",\n                description: `Deleted setting: ${setting.label} (${settingKey})`,\n                old_values: {\n                    setting_key: settingKey,\n                    setting_value: setting.setting_value,\n                    setting_type: setting.setting_type,\n                    category: setting.category,\n                    label: setting.label\n                },\n                status: \"success\",\n                risk_level: \"high\",\n                metadata: {\n                    category: setting.category,\n                    setting_type: setting.setting_type\n                }\n            });\n        }\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: true,\n            message: \"Setting deleted successfully\"\n        });\n    } catch (error) {\n        console.error(\"Delete setting error:\", error);\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            success: false,\n            error: \"Failed to delete setting\"\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvYXBwL2FwaS9hZG1pbi9zZXR0aW5ncy9yb3V0ZS50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQXdEO0FBQ0g7QUFDSTtBQUV6RCw0QkFBNEI7QUFDckIsZUFBZUcsSUFBSUMsT0FBb0I7SUFDNUMsSUFBSTtRQUNGLE1BQU1DLFdBQVcsTUFBTUosa0VBQVlBO1FBRW5DLHlCQUF5QjtRQUN6QixNQUFNLEVBQUVLLE1BQU0sRUFBRUMsSUFBSSxFQUFFLEVBQUUsR0FBRyxNQUFNRixTQUFTRyxJQUFJLENBQUNDLE9BQU87UUFDdEQsSUFBSSxDQUFDRixNQUFNO1lBQ1QsT0FBT1AscURBQVlBLENBQUNVLElBQUksQ0FDdEI7Z0JBQUVDLFNBQVM7Z0JBQU9DLE9BQU87WUFBZSxHQUN4QztnQkFBRUMsUUFBUTtZQUFJO1FBRWxCO1FBRUEsTUFBTSxFQUFFUCxNQUFNUSxRQUFRLEVBQUUsR0FBRyxNQUFNVCxTQUM5QlUsSUFBSSxDQUFDLFNBQ0xDLE1BQU0sQ0FBQyxRQUNQQyxFQUFFLENBQUMsTUFBTVYsS0FBS1csRUFBRSxFQUNoQkMsTUFBTTtRQUVULElBQUksQ0FBQ0wsWUFBWUEsU0FBU00sSUFBSSxLQUFLLFNBQVM7WUFDMUMsT0FBT3BCLHFEQUFZQSxDQUFDVSxJQUFJLENBQ3RCO2dCQUFFQyxTQUFTO2dCQUFPQyxPQUFPO1lBQVksR0FDckM7Z0JBQUVDLFFBQVE7WUFBSTtRQUVsQjtRQUVBLE1BQU0sRUFBRVEsWUFBWSxFQUFFLEdBQUcsSUFBSUMsSUFBSWxCLFFBQVFtQixHQUFHO1FBQzVDLE1BQU1DLFdBQVdILGFBQWFJLEdBQUcsQ0FBQztRQUVsQyxJQUFJQyxRQUFRckIsU0FDVFUsSUFBSSxDQUFDLHFCQUNMQyxNQUFNLENBQUMsS0FDUFcsS0FBSyxDQUFDLFlBQ05BLEtBQUssQ0FBQztRQUVULElBQUlILFVBQVU7WUFDWkUsUUFBUUEsTUFBTVQsRUFBRSxDQUFDLFlBQVlPO1FBQy9CO1FBRUEsTUFBTSxFQUFFbEIsTUFBTXNCLFFB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LEVBQUU7Z0JBQ2hCdUIsWUFBWTtnQkFDWkMsZ0JBQWdCO2dCQUNoQkMsZUFBZTtnQkFDZkMsYUFBYU4sUUFBUXBCLEVBQUU7Z0JBQ3ZCMkIsZUFBZTBCO2dCQUNmekIsUUFBUTtnQkFDUlYsYUFBYSxDQUFDLGlCQUFpQixFQUFFRSxRQUFRSCxLQUFLLENBQUMsRUFBRSxFQUFFb0MsV0FBVyxDQUFDLENBQUM7Z0JBQ2hFRixZQUFZO29CQUFFckMsYUFBYXVDO29CQUFZdEMsZUFBZUssUUFBUUwsYUFBYTtvQkFBRUMsY0FBY0ksUUFBUUosWUFBWTtvQkFBRVYsVUFBVWMsUUFBUWQsUUFBUTtvQkFBRVcsT0FBT0csUUFBUUgsS0FBSztnQkFBQztnQkFDbEt0QixRQUFRO2dCQUNSbUMsWUFBWTtnQkFDWkMsVUFBVTtvQkFBRXpCLFVBQVVjLFFBQVFkLFFBQVE7b0JBQUVVLGNBQWNJLFFBQVFKLFlBQVk7Z0JBQUM7WUFDN0U7UUFDRjtRQUVBLE9BQU9sQyxxREFBWUEsQ0FBQ1UsSUFBSSxDQUFDO1lBQ3ZCQyxTQUFTO1lBQ1RrQixTQUFTO1FBQ1g7SUFDRixFQUFFLE9BQU9qQixPQUFPO1FBQ2RrQixRQUFRbEIsS0FBSyxDQUFDLHlCQUF5QkE7UUFDdkMsT0FBT1oscURBQVlBLENBQUNVLElBQUksQ0FDdEI7WUFBRUMsU0FBUztZQUFPQyxPQUFPO1FBQTJCLEdBQ3BEO1lBQUVDLFFBQVE7UUFBSTtJQUVsQjtBQUNGIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vcGFyZW50aW5nLXNjaG9vbC1wbGF0Zm9ybS8uL3NyYy9hcHAvYXBpL2FkbWluL3NldHRpbmdzL3JvdXRlLnRzPzY0N2IiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgTmV4dFJlcXVlc3QsIE5leHRSZXNwb25zZSB9IGZyb20gJ25leHQvc2VydmVyJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCB9IGZyb20gJ0AvbGliL3N1cGFiYXNlL3NlcnZlcic7XG5pbXBvcnQgeyBsb2dBdWRpdEV2ZW50IH0gZnJvbSAnQC9saWIvYXVkaXQvYXVkaXRTZXJ2aWNlJztcblxuLy8gR0VUIGFsbCBwbGF0Zm9ybSBzZXR0aW5nc1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIEdFVChyZXF1ZXN0OiBOZXh0UmVxdWVzdCkge1xuICB0cnkge1xuICAgIGNvbnN0IHN1cGFiYXNlID0gYXdhaXQgY3JlYXRlQ2xpZW50KCk7XG5cbiAgICAvLyBDaGVjayBpZiB1c2VyIGlzIGFkbWluXG4gICAgY29uc3QgeyBkYXRhOiB7IHVzZXIgfSB9ID0gYXdhaXQgc3VwYWJhc2UuYXV0aC5nZXRVc2VyKCk7XG4gICAgaWYgKCF1c2VyKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnVW5hdXRob3JpemVkJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAxIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBkYXRhOiB1c2VyRGF0YSB9ID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCd1c2VycycpXG4gICAgICAuc2VsZWN0KCdyb2xlJylcbiAgICAgIC5lcSgnaWQnLCB1c2VyLmlkKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKCF1c2VyRGF0YSB8fCB1c2VyRGF0YS5yb2xlICE9PSAnYWRtaW4nKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnRm9yYmlkZGVuJyB9LFxuICAgICAgICB7IHN0YXR1czogNDAzIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBzZWFyY2hQYXJhbXMgfSA9IG5ldyBVUkwocmVxdWVzdC51cmwpO1xuICAgIGNvbnN0IGNhdGVnb3J5ID0gc2VhcmNoUGFyYW1zLmdldCgnY2F0ZWdvcnknKTtcblxuICAgIGxldCBxdWVyeSA9IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncGxhdGZvcm1fc2V0dGluZ3MnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAub3JkZXIoJ2NhdGVnb3J5JylcbiAgICAgIC5vcmRlcignbGFiZWwnKTtcblxuICAgIGlmIChjYXRlZ29yeSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnY2F0ZWdvcnknLCBjYXRlZ29yeSk7XG4gICAgfVxuXG4gICAgY29uc3QgeyBkYXRhOiBzZXR0aW5ncywgZXJyb3IgfSA9IGF3YWl0IHF1ZXJ5O1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oe1xuICAgICAgc3VjY2VzczogdHJ1ZSxcbiAgICAgIGRhdGE6IHNldHRpbmdzLFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0dldCBzZXR0aW5ncyBlcnJvcjonLCBlcnJvcik7XG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGYWlsZWQgdG8gZmV0Y2ggc2V0dGluZ3MnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbi8vIFBPU1QgLSBDcmVhdGUgbmV3IHNldHRpbmdcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQT1NUKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYWRtaW5cbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9IH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IHVzZXJEYXRhIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgIC5zZWxlY3QoJ3JvbGUnKVxuICAgICAgLmVxKCdpZCcsIHVzZXIuaWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoIXVzZXJEYXRhIHx8IHVzZXJEYXRhLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGb3JiaWRkZW4nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB7XG4gICAgICBzZXR0aW5nX2tleSxcbiAgICAgIHNldHRpbmdfdmFsdWUsXG4gICAgICBzZXR0aW5nX3R5cGUsXG4gICAgICBjYXRlZ29yeSxcbiAgICAgIGxhYmVsLFxuICAgICAgZGVzY3JpcHRpb24sXG4gICAgICBpc19wdWJsaWMsXG4gICAgfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgaWYgKCFzZXR0aW5nX2tleSB8fCAhc2V0dGluZ192YWx1ZSB8fCAhc2V0dGluZ190eXBlIHx8ICFjYXRlZ29yeSB8fCAhbGFiZWwpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdNaXNzaW5nIHJlcXVpcmVkIGZpZWxkcycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YTogc2V0dGluZywgZXJyb3IgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgncGxhdGZvcm1fc2V0dGluZ3MnKVxuICAgICAgLmluc2VydCh7XG4gICAgICAgIHNldHRpbmdfa2V5LFxuICAgICAgICBzZXR0aW5nX3ZhbHVlLFxuICAgICAgICBzZXR0aW5nX3R5cGUsXG4gICAgICAgIGNhdGVnb3J5LFxuICAgICAgICBsYWJlbCxcbiAgICAgICAgZGVzY3JpcHRpb24sXG4gICAgICAgIGlzX3B1YmxpYzogaXNfcHVibGljIHx8IGZhbHNlLFxuICAgICAgfSlcbiAgICAgIC5zZWxlY3QoKVxuICAgICAgLnNpbmdsZSgpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBBdWRpdCBsb2dcbiAgICBhd2FpdCBsb2dBdWRpdEV2ZW50KHtcbiAgICAgIHVzZXJfaWQ6IHVzZXIuaWQsXG4gICAgICBldmVudF90eXBlOiAnQ1JFQVRFJyxcbiAgICAgIGV2ZW50X2NhdGVnb3J5OiAnQ09ORklHJyxcbiAgICAgIHJlc291cmNlX3R5cGU6ICdwbGF0Zm9ybV9zZXR0aW5nJyxcbiAgICAgIHJlc291cmNlX2lkOiBzZXR0aW5nLmlkLFxuICAgICAgcmVzb3VyY2VfbmFtZTogc2V0dGluZ19rZXksXG4gICAgICBhY3Rpb246ICdDcmVhdGVkIHBsYXRmb3JtIHNldHRpbmcnLFxuICAgICAgZGVzY3JpcHRpb246IGBDcmVhdGVkIHNldHRpbmc6ICR7bGFiZWx9ICgke3NldHRpbmdfa2V5fSlgLFxuICAgICAgbmV3X3ZhbHVlczogeyBzZXR0aW5nX2tleSwgc2V0dGluZ192YWx1ZSwgc2V0dGluZ190eXBlLCBjYXRlZ29yeSwgbGFiZWwsIGlzX3B1YmxpYyB9LFxuICAgICAgc3RhdHVzOiAnc3VjY2VzcycsXG4gICAgICByaXNrX2xldmVsOiAnbWVkaXVtJyxcbiAgICAgIG1ldGFkYXRhOiB7IGNhdGVnb3J5LCBzZXR0aW5nX3R5cGUgfVxuICAgIH0pO1xuXG4gICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHtcbiAgICAgIHN1Y2Nlc3M6IHRydWUsXG4gICAgICBkYXRhOiBzZXR0aW5nLFxuICAgICAgbWVzc2FnZTogJ1NldHRpbmcgY3JlYXRlZCBzdWNjZXNzZnVsbHknLFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0NyZWF0ZSBzZXR0aW5nIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byBjcmVhdGUgc2V0dGluZycgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cblxuLy8gUFVUIC0gQnVsayB1cGRhdGUgc2V0dGluZ3NcbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBQVVQocmVxdWVzdDogTmV4dFJlcXVlc3QpIHtcbiAgdHJ5IHtcbiAgICBjb25zdCBzdXBhYmFzZSA9IGF3YWl0IGNyZWF0ZUNsaWVudCgpO1xuXG4gICAgLy8gQ2hlY2sgaWYgdXNlciBpcyBhZG1pblxuICAgIGNvbnN0IHsgZGF0YTogeyB1c2VyIH0gfSA9IGF3YWl0IHN1cGFiYXNlLmF1dGguZ2V0VXNlcigpO1xuICAgIGlmICghdXNlcikge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ1VuYXV0aG9yaXplZCcgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMSB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgZGF0YTogdXNlckRhdGEgfSA9IGF3YWl0IHN1cGFiYXNlXG4gICAgICAuZnJvbSgndXNlcnMnKVxuICAgICAgLnNlbGVjdCgncm9sZScpXG4gICAgICAuZXEoJ2lkJywgdXNlci5pZClcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmICghdXNlckRhdGEgfHwgdXNlckRhdGEucm9sZSAhPT0gJ2FkbWluJykge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZvcmJpZGRlbicgfSxcbiAgICAgICAgeyBzdGF0dXM6IDQwMyB9XG4gICAgICApO1xuICAgIH1cblxuICAgIGNvbnN0IHsgc2V0dGluZ3MgfSA9IGF3YWl0IHJlcXVlc3QuanNvbigpO1xuXG4gICAgaWYgKCFzZXR0aW5ncyB8fCAhQXJyYXkuaXNBcnJheShzZXR0aW5ncykpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdJbnZhbGlkIHJlcXVlc3QgZm9ybWF0JyB9LFxuICAgICAgICB7IHN0YXR1czogNDAwIH1cbiAgICAgICk7XG4gICAgfVxuXG4gICAgLy8gR2V0IG9sZCB2YWx1ZXMgZm9yIGF1ZGl0XG4gICAgY29uc3Qgb2xkU2V0dGluZ3NEYXRhID0gYXdhaXQgc3VwYWJhc2VcbiAgICAgIC5mcm9tKCdwbGF0Zm9ybV9zZXR0aW5ncycpXG4gICAgICAuc2VsZWN0KCcqJylcbiAgICAgIC5pbignc2V0dGluZ19rZXknLCBzZXR0aW5ncy5tYXAoKHM6IGFueSkgPT4gcy5zZXR0aW5nX2tleSkpO1xuXG4gICAgY29uc3Qgb2xkU2V0dGluZ3MgPSBvbGRTZXR0aW5nc0RhdGEuZGF0YSB8fCBbXTtcblxuICAgIC8vIFVwZGF0ZSBlYWNoIHNldHRpbmdcbiAgICBjb25zdCB1cGRhdGVQcm9taXNlcyA9IHNldHRpbmdzLm1hcChhc3luYyAoc2V0dGluZzogYW55KSA9PiB7XG4gICAgICByZXR1cm4gc3VwYWJhc2VcbiAgICAgICAgLmZyb20oJ3BsYXRmb3JtX3NldHRpbmdzJylcbiAgICAgICAgLnVwZGF0ZSh7IHNldHRpbmdfdmFsdWU6IHNldHRpbmcuc2V0dGluZ192YWx1ZSB9KVxuICAgICAgICAuZXEoJ3NldHRpbmdfa2V5Jywgc2V0dGluZy5zZXR0aW5nX2tleSlcbiAgICAgICAgLnNlbGVjdCgpXG4gICAgICAgIC5zaW5nbGUoKTtcbiAgICB9KTtcblxuICAgIGNvbnN0IHJlc3VsdHMgPSBhd2FpdCBQcm9taXNlLmFsbCh1cGRhdGVQcm9taXNlcyk7XG4gICAgY29uc3QgZXJyb3JzID0gcmVzdWx0cy5maWx0ZXIociA9PiByLmVycm9yKTtcblxuICAgIGlmIChlcnJvcnMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKFxuICAgICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byB1cGRhdGUgc29tZSBzZXR0aW5ncycgfSxcbiAgICAgICAgeyBzdGF0dXM6IDUwMCB9XG4gICAgICApO1xuICAgIH1cblxuICAgIC8vIEF1ZGl0IGxvZyBmb3IgZWFjaCB1cGRhdGVkIHNldHRpbmdcbiAgICBmb3IgKGNvbnN0IHNldHRpbmcgb2Ygc2V0dGluZ3MpIHtcbiAgICAgIGNvbnN0IG9sZFNldHRpbmcgPSBvbGRTZXR0aW5ncy5maW5kKChzOiBhbnkpID0+IHMuc2V0dGluZ19rZXkgPT09IHNldHRpbmcuc2V0dGluZ19rZXkpO1xuICAgICAgaWYgKG9sZFNldHRpbmcpIHtcbiAgICAgICAgYXdhaXQgbG9nQXVkaXRFdmVudCh7XG4gICAgICAgICAgdXNlcl9pZDogdXNlci5pZCxcbiAgICAgICAgICBldmVudF90eXBlOiAnVVBEQVRFJyxcbiAgICAgICAgICBldmVudF9jYXRlZ29yeTogJ0NPTkZJRycsXG4gICAgICAgICAgcmVzb3VyY2VfdHlwZTogJ3BsYXRmb3JtX3NldHRpbmcnLFxuICAgICAgICAgIHJlc291cmNlX2lkOiBvbGRTZXR0aW5nLmlkLFxuICAgICAgICAgIHJlc291cmNlX25hbWU6IHNldHRpbmcuc2V0dGluZ19rZXksXG4gICAgICAgICAgYWN0aW9uOiAnVXBkYXRlZCBwbGF0Zm9ybSBzZXR0aW5nJyxcbiAgICAgICAgICBkZXNjcmlwdGlvbjogYFVwZGF0ZWQgc2V0dGluZzogJHtvbGRTZXR0aW5nLmxhYmVsfSAoJHtzZXR0aW5nLnNldHRpbmdfa2V5fSlgLFxuICAgICAgICAgIG9sZF92YWx1ZXM6IHsgc2V0dGluZ192YWx1ZTogb2xkU2V0dGluZy5zZXR0aW5nX3ZhbHVlIH0sXG4gICAgICAgICAgbmV3X3ZhbHVlczogeyBzZXR0aW5nX3ZhbHVlOiBzZXR0aW5nLnNldHRpbmdfdmFsdWUgfSxcbiAgICAgICAgICBzdGF0dXM6ICdzdWNjZXNzJyxcbiAgICAgICAgICByaXNrX2xldmVsOiAnbWVkaXVtJyxcbiAgICAgICAgICBtZXRhZGF0YTogeyBjYXRlZ29yeTogb2xkU2V0dGluZy5jYXRlZ29yeSwgc2V0dGluZ190eXBlOiBvbGRTZXR0aW5nLnNldHRpbmdfdHlwZSB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogYCR7c2V0dGluZ3MubGVuZ3RofSBzZXR0aW5ncyB1cGRhdGVkIHN1Y2Nlc3NmdWxseWAsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignVXBkYXRlIHNldHRpbmdzIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byB1cGRhdGUgc2V0dGluZ3MnIH0sXG4gICAgICB7IHN0YXR1czogNTAwIH1cbiAgICApO1xuICB9XG59XG5cbi8vIERFTEVURSAtIERlbGV0ZSBzZXR0aW5nXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gREVMRVRFKHJlcXVlc3Q6IE5leHRSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3Qgc3VwYWJhc2UgPSBhd2FpdCBjcmVhdGVDbGllbnQoKTtcblxuICAgIC8vIENoZWNrIGlmIHVzZXIgaXMgYWRtaW5cbiAgICBjb25zdCB7IGRhdGE6IHsgdXNlciB9IH0gPSBhd2FpdCBzdXBhYmFzZS5hdXRoLmdldFVzZXIoKTtcbiAgICBpZiAoIXVzZXIpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdVbmF1dGhvcml6ZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDEgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGE6IHVzZXJEYXRhIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3VzZXJzJylcbiAgICAgIC5zZWxlY3QoJ3JvbGUnKVxuICAgICAgLmVxKCdpZCcsIHVzZXIuaWQpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBpZiAoIXVzZXJEYXRhIHx8IHVzZXJEYXRhLnJvbGUgIT09ICdhZG1pbicpIHtcbiAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgICAgeyBzdWNjZXNzOiBmYWxzZSwgZXJyb3I6ICdGb3JiaWRkZW4nIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDMgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IHNlYXJjaFBhcmFtcyB9ID0gbmV3IFVSTChyZXF1ZXN0LnVybCk7XG4gICAgY29uc3Qgc2V0dGluZ0tleSA9IHNlYXJjaFBhcmFtcy5nZXQoJ2tleScpO1xuXG4gICAgaWYgKCFzZXR0aW5nS2V5KSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiAnU2V0dGluZyBrZXkgaXMgcmVxdWlyZWQnIH0sXG4gICAgICAgIHsgc3RhdHVzOiA0MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBHZXQgc2V0dGluZyBmb3IgYXVkaXQgYmVmb3JlIGRlbGV0aW5nXG4gICAgY29uc3QgeyBkYXRhOiBzZXR0aW5nIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3BsYXRmb3JtX3NldHRpbmdzJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmVxKCdzZXR0aW5nX2tleScsIHNldHRpbmdLZXkpXG4gICAgICAuc2luZ2xlKCk7XG5cbiAgICBjb25zdCB7IGVycm9yIH0gPSBhd2FpdCBzdXBhYmFzZVxuICAgICAgLmZyb20oJ3BsYXRmb3JtX3NldHRpbmdzJylcbiAgICAgIC5kZWxldGUoKVxuICAgICAgLmVxKCdzZXR0aW5nX2tleScsIHNldHRpbmdLZXkpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICAgIHsgc3VjY2VzczogZmFsc2UsIGVycm9yOiBlcnJvci5tZXNzYWdlIH0sXG4gICAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICAgKTtcbiAgICB9XG5cbiAgICAvLyBBdWRpdCBsb2dcbiAgICBpZiAoc2V0dGluZykge1xuICAgICAgYXdhaXQgbG9nQXVkaXRFdmVudCh7XG4gICAgICAgIHVzZXJfaWQ6IHVzZXIuaWQsXG4gICAgICAgIGV2ZW50X3R5cGU6ICdERUxFVEUnLFxuICAgICAgICBldmVudF9jYXRlZ29yeTogJ0NPTkZJRycsXG4gICAgICAgIHJlc291cmNlX3R5cGU6ICdwbGF0Zm9ybV9zZXR0aW5nJyxcbiAgICAgICAgcmVzb3VyY2VfaWQ6IHNldHRpbmcuaWQsXG4gICAgICAgIHJlc291cmNlX25hbWU6IHNldHRpbmdLZXksXG4gICAgICAgIGFjdGlvbjogJ0RlbGV0ZWQgcGxhdGZvcm0gc2V0dGluZycsXG4gICAgICAgIGRlc2NyaXB0aW9uOiBgRGVsZXRlZCBzZXR0aW5nOiAke3NldHRpbmcubGFiZWx9ICgke3NldHRpbmdLZXl9KWAsXG4gICAgICAgIG9sZF92YWx1ZXM6IHsgc2V0dGluZ19rZXk6IHNldHRpbmdLZXksIHNldHRpbmdfdmFsdWU6IHNldHRpbmcuc2V0dGluZ192YWx1ZSwgc2V0dGluZ190eXBlOiBzZXR0aW5nLnNldHRpbmdfdHlwZSwgY2F0ZWdvcnk6IHNldHRpbmcuY2F0ZWdvcnksIGxhYmVsOiBzZXR0aW5nLmxhYmVsIH0sXG4gICAgICAgIHN0YXR1czogJ3N1Y2Nlc3MnLFxuICAgICAgICByaXNrX2xldmVsOiAnaGlnaCcsXG4gICAgICAgIG1ldGFkYXRhOiB7IGNhdGVnb3J5OiBzZXR0aW5nLmNhdGVnb3J5LCBzZXR0aW5nX3R5cGU6IHNldHRpbmcuc2V0dGluZ190eXBlIH1cbiAgICAgIH0pO1xuICAgIH1cblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBzdWNjZXNzOiB0cnVlLFxuICAgICAgbWVzc2FnZTogJ1NldHRpbmcgZGVsZXRlZCBzdWNjZXNzZnVsbHknLFxuICAgIH0pO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0RlbGV0ZSBzZXR0aW5nIGVycm9yOicsIGVycm9yKTtcbiAgICByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oXG4gICAgICB7IHN1Y2Nlc3M6IGZhbHNlLCBlcnJvcjogJ0ZhaWxlZCB0byBkZWxldGUgc2V0dGluZycgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cbn1cbiJdLCJuYW1lcyI6WyJOZXh0UmVzcG9uc2UiLCJjcmVhdGVDbGllbnQiLCJsb2dBdWRpdEV2ZW50IiwiR0VUIiwicmVxdWVzdCIsInN1cGFiYXNlIiwiZGF0YSIsInVzZXIiLCJhdXRoIiwiZ2V0VXNlciIsImpzb24iLCJzdWNjZXNzIiwiZXJyb3IiLCJzdGF0dXMiLCJ1c2VyRGF0YSIsImZyb20iLCJzZWxlY3QiLCJlcSIsImlkIiwic2luZ2xlIiwicm9sZSIsInNlYXJjaFBhcmFtcyIsIlVSTCIsInVybCIsImNhdGVnb3J5IiwiZ2V0IiwicXVlcnkiLCJvcmRlciIsInNldHRpbmdzIiwibWVzc2FnZSIsImNvbnNvbGUiLCJQT1NUIiwic2V0dGluZ19rZXkiLCJzZXR0aW5nX3ZhbHVlIiwic2V0dGluZ190eXBlIiwibGFiZWwiLCJkZXNjcmlwdGlvbiIsImlzX3B1YmxpYyIsInNldHRpbmciLCJpbnNlcnQiLCJ1c2VyX2lkIiwiZXZlbnRfdHlwZSIsImV2ZW50X2NhdGVnb3J5IiwicmVzb3VyY2VfdHlwZSIsInJlc291cmNlX2lkIiwicmVzb3VyY2VfbmFtZSIsImFjdGlvbiIsIm5ld192YWx1ZXMiLCJyaXNrX2xldmVsIiwibWV0YWRhdGEiLCJQVVQiLCJBcnJheSIsImlzQXJyYXkiLCJvbGRTZXR0aW5nc0RhdGEiLCJpbiIsIm1hcCIsInMiLCJvbGRTZXR0aW5ncyIsInVwZGF0ZVByb21pc2VzIiwidXBkYXRlIiwicmVzdWx0cyIsIlByb21pc2UiLCJhbGwiLCJlcnJvcnMiLCJmaWx0ZXIiLCJyIiwibGVuZ3RoIiwib2xkU2V0dGluZyIsImZpbmQiLCJvbGRfdmFsdWVzIiwiREVMRVRFIiwic2V0dGluZ0tleSIsImRlbGV0ZSJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/app/api/admin/settings/route.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/audit/auditService.ts":
/*!***************************************!*\
  !*** ./src/lib/audit/auditService.ts ***!
  \***************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   auditService: () => (/* binding */ auditService),\n/* harmony export */   \"default\": () => (__WEBPACK_DEFAULT_EXPORT__),\n/* harmony export */   generateComplianceReport: () => (/* binding */ generateComplianceReport),\n/* harmony export */   generateSessionId: () => (/* binding */ generateSessionId),\n/* harmony export */   getActiveAlerts: () => (/* binding */ getActiveAlerts),\n/* harmony export */   getAuditEvents: () => (/* binding */ getAuditEvents),\n/* harmony export */   getClientInfo: () => (/* binding */ getClientInfo),\n/* harmony export */   getGradeChanges: () => (/* binding */ getGradeChanges),\n/* harmony export */   getHighRiskEvents: () => (/* binding */ getHighRiskEvents),\n/* harmony export */   getParentalConsent: () => (/* binding */ getParentalConsent),\n/* harmony export */   getStudentRecordAccess: () => (/* binding */ getStudentRecordAccess),\n/* harmony export */   hasValidConsent: () => (/* binding */ hasValidConsent),\n/* harmony export */   logAuditEvent: () => (/* binding */ logAuditEvent),\n/* harmony export */   logAuthEvent: () => (/* binding */ logAuthEvent),\n/* harmony export */   logConfigChange: () => (/* binding */ logConfigChange),\n/* harmony export */   logConsentAction: () => (/* binding */ logConsentAction),\n/* harmony export */   logDataExport: () => (/* binding */ logDataExport),\n/* harmony export */   logGradeChange: () => (/* binding */ logGradeChange),\n/* harmony export */   logStudentRecordAccess: () => (/* binding */ logStudentRecordAccess),\n/* harmony export */   verifyAuditChain: () => (/* binding */ verifyAuditChain)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// ============================================================================\n// AUDIT TRAIL SERVICE\n// Centralized service for logging and retrieving audit events\n// ============================================================================\n\n// Initialize Supabase client\n// Note: Uses SERVICE_ROLE_KEY to bypass RLS for system-level audit logging\nconst supabaseUrl = \"https://dgdondsvtqbqnsecbayx.supabase.co\" || 0;\nconst supabaseServiceKey = process.env.SUPABASE_SERVICE_ROLE_KEY || \"\";\nlet supabase = null;\nfunction getSupabaseClient() {\n    if (!supabase) {\n        supabase = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(supabaseUrl, supabaseServiceKey, {\n            auth: {\n                autoRefreshToken: false,\n                persistSession: false\n            }\n        });\n    }\n    return supabase;\n}\n// ============================================================================\n// CORE AUDIT LOGGING\n// ============================================================================\n/**\n * Log an audit event using the database function\n * This is the main function to call from application code\n */ async function logAuditEvent(params) {\n    try {\n        const client = getSupabaseClient();\n        // Call the database function\n        const { data, error } = await client.rpc(\"log_audit_event\", {\n            p_user_id: params.user_id || null,\n            p_event_type: params.event_type,\n            p_event_category: params.event_category,\n            p_resource_type: params.resource_type,\n            p_resource_id: params.resource_id || null,\n            p_resource_name: params.resource_name || null,\n            p_action: params.action,\n            p_description: params.description || null,\n            p_old_values: params.old_values || null,\n            p_new_values: params.new_values || null,\n            p_session_id: params.session_id || null,\n            p_ip_address: params.ip_address || null,\n            p_user_agent: params.user_agent || null,\n            p_status: params.status || \"success\",\n            p_risk_level: params.risk_level || \"low\",\n            p_metadata: params.metadata || null\n        });\n        if (error) {\n            console.error(\"Error logging audit event:\", error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error(\"Exception logging audit event:\", error);\n        return null;\n    }\n}\n/**\n * Helper function to get current user's IP address and user agent\n */ function getClientInfo(req) {\n    if (false) {}\n    if (req) {\n        // Server-side with request object\n        const forwarded = req.headers.get(\"x-forwarded-for\");\n        const ip = forwarded ? forwarded.split(\",\")[0] : req.headers.get(\"x-real-ip\") || undefined;\n        return {\n            ip,\n            userAgent: req.headers.get(\"user-agent\") || undefined\n        };\n    }\n    return {};\n}\n/**\n * Generate a session ID for tracking user sessions\n */ function generateSessionId() {\n    return `session_${Date.now()}_${Math.random().toString(36).substring(7)}`;\n}\n// ============================================================================\n// CONVENIENCE LOGGING FUNCTIONS\n// ============================================================================\n/**\n * Log user authentication event\n */ async function logAuthEvent(userId, action, metadata) {\n    const clientInfo = getClientInfo();\n    return logAuditEvent({\n        user_id: userId,\n        event_type: action === \"login\" ? \"LOGIN\" : action === \"logout\" ? \"LOGOUT\" : \"ACCESS\",\n        event_category: \"AUTH\",\n        resource_type: \"auth_session\",\n        action: action.replace(\"_\", \" \"),\n        status: action === \"failed_login\" ? \"failure\" : \"success\",\n        risk_level: action === \"failed_login\" ? \"medium\" : \"low\",\n        ...clientInfo,\n        metadata\n    });\n}\n/**\n * Log student record access (FERPA compliance)\n */ async function logStudentRecordAccess(userId, studentId, resourceType, resourceId, action, metadata) {\n    const clientInfo = getClientInfo();\n    return logAuditEvent({\n        user_id: userId,\n        event_type: \"ACCESS\",\n        event_category: \"STUDENT_RECORD\",\n        resource_type: resourceType,\n        resource_id: resourceId,\n        action,\n        student_id: studentId,\n        is_student_record: true,\n        compliance_flags: [\n            \"FERPA\"\n        ],\n        risk_level: \"medium\",\n        ...clientInfo,\n        metadata\n    });\n}\n/**\n * Log grade change (high-risk event)\n */ async function logGradeChange(userId, studentId, gradeId, oldGrade, newGrade, metadata) {\n    const clientInfo = getClientInfo();\n    return logAuditEvent({\n        user_id: userId,\n        event_type: \"UPDATE\",\n        event_category: \"GRADE\",\n        resource_type: \"grades\",\n        resource_id: gradeId,\n        action: \"Updated student grade\",\n        old_values: oldGrade,\n        new_values: newGrade,\n        student_id: studentId,\n        is_student_record: true,\n        compliance_flags: [\n            \"FERPA\"\n        ],\n        risk_level: \"high\",\n        ...clientInfo,\n        metadata\n    });\n}\n/**\n * Log parental consent action (COPPA compliance)\n */ async function logConsentAction(userId, studentId, consentId, action, consentType, metadata) {\n    const clientInfo = getClientInfo();\n    return logAuditEvent({\n        user_id: userId,\n        event_type: \"CONSENT\",\n        event_category: \"COMPLIANCE\",\n        resource_type: \"parental_consent\",\n        resource_id: consentId,\n        action,\n        student_id: studentId,\n        parental_consent_id: consentId,\n        compliance_flags: [\n            \"COPPA\",\n            \"FERPA\"\n        ],\n        risk_level: \"medium\",\n        ...clientInfo,\n        metadata: {\n            consent_type: consentType,\n            ...metadata\n        }\n    });\n}\n/**\n * Log data export (high-risk event)\n */ async function logDataExport(userId, resourceType, exportFormat, recordCount, metadata) {\n    const clientInfo = getClientInfo();\n    return logAuditEvent({\n        user_id: userId,\n        event_type: \"EXPORT\",\n        event_category: \"DATA\",\n        resource_type: resourceType,\n        action: `Exported ${recordCount} ${resourceType} records as ${exportFormat}`,\n        risk_level: recordCount > 100 ? \"high\" : \"medium\",\n        ...clientInfo,\n        metadata: {\n            export_format: exportFormat,\n            record_count: recordCount,\n            ...metadata\n        }\n    });\n}\n/**\n * Log configuration change (admin action)\n */ async function logConfigChange(userId, resourceType, resourceId, oldValues, newValues, metadata) {\n    const clientInfo = getClientInfo();\n    // Filter out automatic database fields that shouldn't be shown in audit logs\n    const automaticFields = [\n        \"updated_at\",\n        \"created_at\",\n        \"id\"\n    ];\n    const filteredOldValues = oldValues ? Object.fromEntries(Object.entries(oldValues).filter(([key])=>!automaticFields.includes(key))) : undefined;\n    const filteredNewValues = newValues ? Object.fromEntries(Object.entries(newValues).filter(([key])=>!automaticFields.includes(key))) : undefined;\n    return logAuditEvent({\n        user_id: userId,\n        event_type: \"UPDATE\",\n        event_category: \"CONFIG\",\n        resource_type: resourceType,\n        resource_id: resourceId,\n        action: `Updated ${resourceType} configuration`,\n        old_values: filteredOldValues,\n        new_values: filteredNewValues,\n        risk_level: \"high\",\n        ...clientInfo,\n        metadata\n    });\n}\n// ============================================================================\n// AUDIT RETRIEVAL\n// ============================================================================\n/**\n * Get audit events with filters\n */ async function getAuditEvents(filters = {}) {\n    try {\n        const client = getSupabaseClient();\n        let query = client.from(\"audit_events\").select(\"*\", {\n            count: \"exact\"\n        });\n        // Apply filters\n        if (filters.date_from) {\n            query = query.gte(\"event_timestamp\", filters.date_from);\n        }\n        if (filters.date_to) {\n            query = query.lte(\"event_timestamp\", filters.date_to);\n        }\n        if (filters.user_ids && filters.user_ids.length > 0) {\n            query = query.in(\"user_id\", filters.user_ids);\n        }\n        if (filters.student_ids && filters.student_ids.length > 0) {\n            query = query.in(\"student_id\", filters.student_ids);\n        }\n        if (filters.event_types && filters.event_types.length > 0) {\n            query = query.in(\"event_type\", filters.event_types);\n        }\n        if (filters.event_categories && filters.event_categories.length > 0) {\n            query = query.in(\"event_category\", filters.event_categories);\n        }\n        if (filters.resource_types && filters.resource_types.length > 0) {\n            query = query.in(\"resource_type\", filters.resource_types);\n        }\n        if (filters.risk_levels && filters.risk_levels.length > 0) {\n            query = query.in(\"risk_level\", filters.risk_levels);\n        }\n        if (filters.status && filters.status.length > 0) {\n            query = query.in(\"status\", filters.status);\n        }\n        if (filters.is_student_record !== undefined) {\n            query = query.eq(\"is_student_record\", filters.is_student_record);\n        }\n        if (filters.is_minor_data !== undefined) {\n            query = query.eq(\"is_minor_data\", filters.is_minor_data);\n        }\n        if (filters.search) {\n            query = query.textSearch(\"search_vector\", filters.search);\n        }\n        // Order by timestamp descending\n        query = query.order(\"event_timestamp\", {\n            ascending: false\n        });\n        // Pagination\n        if (filters.limit) {\n            query = query.limit(filters.limit);\n        }\n        if (filters.offset) {\n            query = query.range(filters.offset, filters.offset + (filters.limit || 50) - 1);\n        }\n        const { data, error, count } = await query;\n        return {\n            data: data || [],\n            error,\n            count: count || 0\n        };\n    } catch (error) {\n        console.error(\"Error getting audit events:\", error);\n        return {\n            data: [],\n            error,\n            count: 0\n        };\n    }\n}\n/**\n * Get student record access logs (FERPA view)\n */ async function getStudentRecordAccess(studentId, dateFrom, dateTo) {\n    try {\n        const client = getSupabaseClient();\n        let query = client.from(\"audit_student_record_access\").select(\"*\");\n        if (studentId) {\n            query = query.eq(\"student_id\", studentId);\n        }\n        if (dateFrom) {\n            query = query.gte(\"event_timestamp\", dateFrom);\n        }\n        if (dateTo) {\n            query = query.lte(\"event_timestamp\", dateTo);\n        }\n        query = query.order(\"event_timestamp\", {\n            ascending: false\n        }).limit(100);\n        const { data, error } = await query;\n        return {\n            data: data || [],\n            error\n        };\n    } catch (error) {\n        console.error(\"Error getting student record access:\", error);\n        return {\n            data: [],\n            error\n        };\n    }\n}\n/**\n * Get grade changes audit\n */ async function getGradeChanges(studentId, dateFrom, dateTo) {\n    try {\n        const client = getSupabaseClient();\n        let query = client.from(\"audit_grade_changes\").select(\"*\");\n        if (studentId) {\n            query = query.eq(\"student_id\", studentId);\n        }\n        if (dateFrom) {\n            query = query.gte(\"event_timestamp\", dateFrom);\n        }\n        if (dateTo) {\n            query = query.lte(\"event_timestamp\", dateTo);\n        }\n        query = query.order(\"event_timestamp\", {\n            ascending: false\n        }).limit(100);\n        const { data, error } = await query;\n        return {\n            data: data || [],\n            error\n        };\n    } catch (error) {\n        console.error(\"Error getting grade changes:\", error);\n        return {\n            data: [],\n            error\n        };\n    }\n}\n/**\n * Get high-risk events\n */ async function getHighRiskEvents(limit = 50) {\n    try {\n        const client = getSupabaseClient();\n        const { data, error } = await client.from(\"audit_high_risk_events\").select(\"*\").order(\"event_timestamp\", {\n            ascending: false\n        }).limit(limit);\n        return {\n            data: data || [],\n            error\n        };\n    } catch (error) {\n        console.error(\"Error getting high-risk events:\", error);\n        return {\n            data: [],\n            error\n        };\n    }\n}\n/**\n * Get active alerts\n */ async function getActiveAlerts() {\n    try {\n        const client = getSupabaseClient();\n        const { data, error } = await client.from(\"audit_alerts\").select(\"*\").in(\"status\", [\n            \"open\",\n            \"investigating\"\n        ]).order(\"detected_at\", {\n            ascending: false\n        });\n        return {\n            data: data || [],\n            error\n        };\n    } catch (error) {\n        console.error(\"Error getting active alerts:\", error);\n        return {\n            data: [],\n            error\n        };\n    }\n}\n// ============================================================================\n// PARENTAL CONSENT MANAGEMENT\n// ============================================================================\n/**\n * Get parental consent for a student\n */ async function getParentalConsent(studentId) {\n    try {\n        const client = getSupabaseClient();\n        const { data, error } = await client.from(\"parental_consent_audit\").select(\"*\").eq(\"student_id\", studentId).order(\"requested_at\", {\n            ascending: false\n        });\n        return {\n            data: data || [],\n            error\n        };\n    } catch (error) {\n        console.error(\"Error getting parental consent:\", error);\n        return {\n            data: [],\n            error\n        };\n    }\n}\n/**\n * Check if student has valid consent for a specific type\n */ async function hasValidConsent(studentId, consentType) {\n    try {\n        const client = getSupabaseClient();\n        const { data, error } = await client.from(\"parental_consent_audit\").select(\"id, consent_status, expires_at\").eq(\"student_id\", studentId).eq(\"consent_type\", consentType).eq(\"consent_status\", \"granted\").single();\n        if (error || !data) {\n            return false;\n        }\n        // Check if expired\n        const consentData = data;\n        if (consentData.expires_at) {\n            const expiryDate = new Date(consentData.expires_at);\n            if (expiryDate < new Date()) {\n                return false;\n            }\n        }\n        return true;\n    } catch (error) {\n        console.error(\"Error checking consent:\", error);\n        return false;\n    }\n}\n// ============================================================================\n// UTILITY FUNCTIONS\n// ============================================================================\n/**\n * Verify audit chain integrity\n */ async function verifyAuditChain(dateFrom, dateTo) {\n    try {\n        const client = getSupabaseClient();\n        const { data, error } = await client.rpc(\"verify_audit_chain\", {\n            p_date_from: dateFrom || new Date(Date.now() - 24 * 60 * 60 * 1000).toISOString(),\n            p_date_to: dateTo || new Date().toISOString()\n        });\n        if (error) {\n            console.error(\"Error verifying audit chain:\", error);\n            return {\n                isValid: false,\n                totalEvents: 0,\n                invalidEvents: 0\n            };\n        }\n        const result = data;\n        return {\n            isValid: result[0].is_valid,\n            totalEvents: result[0].total_events,\n            invalidEvents: result[0].invalid_events\n        };\n    } catch (error) {\n        console.error(\"Exception verifying audit chain:\", error);\n        return {\n            isValid: false,\n            totalEvents: 0,\n            invalidEvents: 0\n        };\n    }\n}\n/**\n * Generate compliance report\n */ async function generateComplianceReport(framework, dateFrom, dateTo) {\n    try {\n        const client = getSupabaseClient();\n        const { data, error } = await client.rpc(\"generate_compliance_report\", {\n            p_framework: framework,\n            p_date_from: dateFrom || new Date(Date.now() - 30 * 24 * 60 * 60 * 1000).toISOString(),\n            p_date_to: dateTo || new Date().toISOString()\n        });\n        if (error) {\n            console.error(\"Error generating compliance report:\", error);\n            return null;\n        }\n        return data;\n    } catch (error) {\n        console.error(\"Exception generating compliance report:\", error);\n        return null;\n    }\n}\nconst auditService = {\n    logAuditEvent,\n    logAuthEvent,\n    logStudentRecordAccess,\n    logGradeChange,\n    logConsentAction,\n    logDataExport,\n    logConfigChange,\n    getAuditEvents,\n    getStudentRecordAccess,\n    getGradeChanges,\n    getHighRiskEvents,\n    getActiveAlerts,\n    getParentalConsent,\n    hasValidConsent,\n    verifyAuditChain,\n    generateComplianceReport,\n    getClientInfo,\n    generateSessionId\n};\n/* harmony default export */ const __WEBPACK_DEFAULT_EXPORT__ = (auditService);\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTtZQUNyRCxPQUFPO1FBQ1Q7UUFFQSxPQUFPRDtJQUNULEVBQUUsT0FBT0MsT0FBTztRQUNka0MsUUFBUWxDLEtBQUssQ0FBQywyQ0FBMkNBO1FBQ3pELE9BQU87SUFDVDtBQUNGO0FBRU8sTUFBTThJLGVBQWU7SUFDMUJsSjtJQUNBd0Q7SUFDQUk7SUFDQU87SUFDQUk7SUFDQUs7SUFDQUs7SUFDQVk7SUFDQTJCO0lBQ0FHO0lBQ0FDO0lBQ0FDO0lBQ0FDO0lBQ0FDO0lBQ0FLO0lBQ0FXO0lBQ0F4RztJQUNBVTtBQUNGLEVBQUU7QUFFRixpRUFBZWlHLFlBQVlBLEVBQUMiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9wYXJlbnRpbmctc2Nob29sLXBsYXRmb3JtLy4vc3JjL2xpYi9hdWRpdC9hdWRpdFNlcnZpY2UudHM/ZDgxMiJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBBVURJVCBUUkFJTCBTRVJWSUNFXG4vLyBDZW50cmFsaXplZCBzZXJ2aWNlIGZvciBsb2dnaW5nIGFuZCByZXRyaWV2aW5nIGF1ZGl0IGV2ZW50c1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tICdAc3VwYWJhc2Uvc3VwYWJhc2UtanMnO1xuaW1wb3J0IHR5cGUge1xuICBBdWRpdEV2ZW50LFxuICBDcmVhdGVBdWRpdEV2ZW50UGFyYW1zLFxuICBBdWRpdEZpbHRlcnMsXG4gIFBhcmVudGFsQ29uc2VudCxcbiAgU3R1ZGVudFJlY29yZEFjY2VzcyxcbiAgR3JhZGVDaGFuZ2UsXG4gIEF1ZGl0QWxlcnQsXG59IGZyb20gJy4vdHlwZXMnO1xuXG4vLyBJbml0aWFsaXplIFN1cGFiYXNlIGNsaWVudFxuLy8gTm90ZTogVXNlcyBTRVJWSUNFX1JPTEVfS0VZIHRvIGJ5cGFzcyBSTFMgZm9yIHN5c3RlbS1sZXZlbCBhdWRpdCBsb2dnaW5nXG5jb25zdCBzdXBhYmFzZVVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCB8fCAnJztcbmNvbnN0IHN1cGFiYXNlU2VydmljZUtleSA9IHByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkgfHwgJyc7XG5cbmxldCBzdXBhYmFzZTogUmV0dXJuVHlwZTx0eXBlb2YgY3JlYXRlQ2xpZW50PiB8IG51bGwgPSBudWxsO1xuXG5mdW5jdGlvbiBnZXRTdXBhYmFzZUNsaWVudCgpIHtcbiAgaWYgKCFzdXBhYmFzZSkge1xuICAgIHN1cGFiYXNlID0gY3JlYXRlQ2xpZW50KHN1cGFiYXNlVXJsLCBzdXBhYmFzZVNlcnZpY2VLZXksIHtcbiAgICAgIGF1dGg6IHtcbiAgICAgICAgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UsXG4gICAgICAgIHBlcnNpc3RTZXNzaW9uOiBmYWxzZVxuICAgICAgfVxuICAgIH0pO1xuICB9XG4gIHJldHVybiBzdXBhYmFzZTtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09SRSBBVURJVCBMT0dHSU5HXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG5cbi8qKlxuICogTG9nIGFuIGF1ZGl0IGV2ZW50IHVzaW5nIHRoZSBkYXRhYmFzZSBmdW5jdGlvblxuICogVGhpcyBpcyB0aGUgbWFpbiBmdW5jdGlvbiB0byBjYWxsIGZyb20gYXBwbGljYXRpb24gY29kZVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nQXVkaXRFdmVudChwYXJhbXM6IENyZWF0ZUF1ZGl0RXZlbnRQYXJhbXMpOiBQcm9taXNlPHN0cmluZyB8IG51bGw+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjbGllbnQgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xuXG4gICAgLy8gQ2FsbCB0aGUgZGF0YWJhc2UgZnVuY3Rpb25cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBjbGllbnQucnBjKCdsb2dfYXVkaXRfZXZlbnQnLCB7XG4gICAgICBwX3VzZXJfaWQ6IHBhcmFtcy51c2VyX2lkIHx8IG51bGwsXG4gICAgICBwX2V2ZW50X3R5cGU6IHBhcmFtcy5ldmVudF90eXBlLFxuICAgICAgcF9ldmVudF9jYXRlZ29yeTogcGFyYW1zLmV2ZW50X2NhdGVnb3J5LFxuICAgICAgcF9yZXNvdXJjZV90eXBlOiBwYXJhbXMucmVzb3VyY2VfdHlwZSxcbiAgICAgIHBfcmVzb3VyY2VfaWQ6IHBhcmFtcy5yZXNvdXJjZV9pZCB8fCBudWxsLFxuICAgICAgcF9yZXNvdXJjZV9uYW1lOiBwYXJhbXMucmVzb3VyY2VfbmFtZSB8fCBudWxsLFxuICAgICAgcF9hY3Rpb246IHBhcmFtcy5hY3Rpb24sXG4gICAgICBwX2Rlc2NyaXB0aW9uOiBwYXJhbXMuZGVzY3JpcHRpb24gfHwgbnVsbCxcbiAgICAgIHBfb2xkX3ZhbHVlczogcGFyYW1zLm9sZF92YWx1ZXMgfHwgbnVsbCxcbiAgICAgIHBfbmV3X3ZhbHVlczogcGFyYW1zLm5ld192YWx1ZXMgfHwgbnVsbCxcbiAgICAgIHBfc2Vzc2lvbl9pZDogcGFyYW1zLnNlc3Npb25faWQgfHwgbnVsbCxcbiAgICAgIHBfaXBfYWRkcmVzczogcGFyYW1zLmlwX2FkZHJlc3MgfHwgbnVsbCxcbiAgICAgIHBfdXNlcl9hZ2VudDogcGFyYW1zLnVzZXJfYWdlbnQgfHwgbnVsbCxcbiAgICAgIHBfc3RhdHVzOiBwYXJhbXMuc3RhdHVzIHx8ICdzdWNjZXNzJyxcbiAgICAgIHBfcmlza19sZXZlbDogcGFyYW1zLnJpc2tfbGV2ZWwgfHwgJ2xvdycsXG4gICAgICBwX21ldGFkYXRhOiBwYXJhbXMubWV0YWRhdGEgfHwgbnVsbCxcbiAgICB9IGFzIGFueSk7XG5cbiAgICBpZiAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGxvZ2dpbmcgYXVkaXQgZXZlbnQ6JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgcmV0dXJuIGRhdGEgYXMgc3RyaW5nO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0V4Y2VwdGlvbiBsb2dnaW5nIGF1ZGl0IGV2ZW50OicsIGVycm9yKTtcbiAgICByZXR1cm4gbnVsbDtcbiAgfVxufVxuXG4vKipcbiAqIEhlbHBlciBmdW5jdGlvbiB0byBnZXQgY3VycmVudCB1c2VyJ3MgSVAgYWRkcmVzcyBhbmQgdXNlciBhZ2VudFxuICovXG5leHBvcnQgZnVuY3Rpb24gZ2V0Q2xpZW50SW5mbyhyZXE/OiBSZXF1ZXN0KTogeyBpcD86IHN0cmluZzsgdXNlckFnZW50Pzogc3RyaW5nIH0ge1xuICBpZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcpIHtcbiAgICAvLyBDbGllbnQtc2lkZVxuICAgIHJldHVybiB7XG4gICAgICB1c2VyQWdlbnQ6IG5hdmlnYXRvci51c2VyQWdlbnQsXG4gICAgfTtcbiAgfVxuXG4gIGlmIChyZXEpIHtcbiAgICAvLyBTZXJ2ZXItc2lkZSB3aXRoIHJlcXVlc3Qgb2JqZWN0XG4gICAgY29uc3QgZm9yd2FyZGVkID0gcmVxLmhlYWRlcnMuZ2V0KCd4LWZvcndhcmRlZC1mb3InKTtcbiAgICBjb25zdCBpcCA9IGZvcndhcmRlZCA/IGZvcndhcmRlZC5zcGxpdCgnLCcpWzBdIDogcmVxLmhlYWRlcnMuZ2V0KCd4LXJlYWwtaXAnKSB8fCB1bmRlZmluZWQ7XG5cbiAgICByZXR1cm4ge1xuICAgICAgaXAsXG4gICAgICB1c2VyQWdlbnQ6IHJlcS5oZWFkZXJzLmdldCgndXNlci1hZ2VudCcpIHx8IHVuZGVmaW5lZCxcbiAgICB9O1xuICB9XG5cbiAgcmV0dXJuIHt9O1xufVxuXG4vKipcbiAqIEdlbmVyYXRlIGEgc2Vzc2lvbiBJRCBmb3IgdHJhY2tpbmcgdXNlciBzZXNzaW9uc1xuICovXG5leHBvcnQgZnVuY3Rpb24gZ2VuZXJhdGVTZXNzaW9uSWQoKTogc3RyaW5nIHtcbiAgcmV0dXJuIGBzZXNzaW9uXyR7RGF0ZS5ub3coKX1fJHtNYXRoLnJhbmRvbSgpLnRvU3RyaW5nKDM2KS5zdWJzdHJpbmcoNyl9YDtcbn1cblxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuLy8gQ09OVkVOSUVOQ0UgTE9HR0lORyBGVU5DVElPTlNcbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cblxuLyoqXG4gKiBMb2cgdXNlciBhdXRoZW50aWNhdGlvbiBldmVudFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nQXV0aEV2ZW50KFxuICB1c2VySWQ6IHN0cmluZyB8IHVuZGVmaW5lZCxcbiAgYWN0aW9uOiAnbG9naW4nIHwgJ2xvZ291dCcgfCAnZmFpbGVkX2xvZ2luJyB8ICdwYXNzd29yZF9yZXNldCcsXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuKSB7XG4gIGNvbnN0IGNsaWVudEluZm8gPSBnZXRDbGllbnRJbmZvKCk7XG5cbiAgcmV0dXJuIGxvZ0F1ZGl0RXZlbnQoe1xuICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICBldmVudF90eXBlOiBhY3Rpb24gPT09ICdsb2dpbicgPyAnTE9HSU4nIDogYWN0aW9uID09PSAnbG9nb3V0JyA/ICdMT0dPVVQnIDogJ0FDQ0VTUycsXG4gICAgZXZlbnRfY2F0ZWdvcnk6ICdBVVRIJyxcbiAgICByZXNvdXJjZV90eXBlOiAnYXV0aF9zZXNzaW9uJyxcbiAgICBhY3Rpb246IGFjdGlvbi5yZXBsYWNlKCdfJywgJyAnKSxcbiAgICBzdGF0dXM6IGFjdGlvbiA9PT0gJ2ZhaWxlZF9sb2dpbicgPyAnZmFpbHVyZScgOiAnc3VjY2VzcycsXG4gICAgcmlza19sZXZlbDogYWN0aW9uID09PSAnZmFpbGVkX2xvZ2luJyA/ICdtZWRpdW0nIDogJ2xvdycsXG4gICAgLi4uY2xpZW50SW5mbyxcbiAgICBtZXRhZGF0YSxcbiAgfSk7XG59XG5cbi8qKlxuICogTG9nIHN0dWRlbnQgcmVjb3JkIGFjY2VzcyAoRkVSUEEgY29tcGxpYW5jZSlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGxvZ1N0dWRlbnRSZWNvcmRBY2Nlc3MoXG4gIHVzZXJJZDogc3RyaW5nLFxuICBzdHVkZW50SWQ6IHN0cmluZyxcbiAgcmVzb3VyY2VUeXBlOiBzdHJpbmcsXG4gIHJlc291cmNlSWQ6IHN0cmluZyxcbiAgYWN0aW9uOiBzdHJpbmcsXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuKSB7XG4gIGNvbnN0IGNsaWVudEluZm8gPSBnZXRDbGllbnRJbmZvKCk7XG5cbiAgcmV0dXJuIGxvZ0F1ZGl0RXZlbnQoe1xuICAgIHVzZXJfaWQ6IHVzZXJJZCxcbiAgICBldmVudF90eXBlOiAnQUNDRVNTJyxcbiAgICBldmVudF9jYXRlZ29yeTogJ1NUVURFTlRfUkVDT1JEJyxcbiAgICByZXNvdXJjZV90eXBlOiByZXNvdXJjZVR5cGUsXG4gICAgcmVzb3VyY2VfaWQ6IHJlc291cmNlSWQsXG4gICAgYWN0aW9uLFxuICAgIHN0dWRlbnRfaWQ6IHN0dWRlbnRJZCxcbiAgICBpc19zdHVkZW50X3JlY29yZDogdHJ1ZSxcbiAgICBjb21wbGlhbmNlX2ZsYWdzOiBbJ0ZFUlBBJ10sXG4gICAgcmlza19sZXZlbDogJ21lZGl1bScsXG4gICAgLi4uY2xpZW50SW5mbyxcbiAgICBtZXRhZGF0YSxcbiAgfSk7XG59XG5cbi8qKlxuICogTG9nIGdyYWRlIGNoYW5nZSAoaGlnaC1yaXNrIGV2ZW50KVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nR3JhZGVDaGFuZ2UoXG4gIHVzZXJJZDogc3RyaW5nLFxuICBzdHVkZW50SWQ6IHN0cmluZyxcbiAgZ3JhZGVJZDogc3RyaW5nLFxuICBvbGRHcmFkZTogYW55LFxuICBuZXdHcmFkZTogYW55LFxuICBtZXRhZGF0YT86IFJlY29yZDxzdHJpbmcsIGFueT5cbikge1xuICBjb25zdCBjbGllbnRJbmZvID0gZ2V0Q2xpZW50SW5mbygpO1xuXG4gIHJldHVybiBsb2dBdWRpdEV2ZW50KHtcbiAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgZXZlbnRfdHlwZTogJ1VQREFURScsXG4gICAgZXZlbnRfY2F0ZWdvcnk6ICdHUkFERScsXG4gICAgcmVzb3VyY2VfdHlwZTogJ2dyYWRlcycsXG4gICAgcmVzb3VyY2VfaWQ6IGdyYWRlSWQsXG4gICAgYWN0aW9uOiAnVXBkYXRlZCBzdHVkZW50IGdyYWRlJyxcbiAgICBvbGRfdmFsdWVzOiBvbGRHcmFkZSxcbiAgICBuZXdfdmFsdWVzOiBuZXdHcmFkZSxcbiAgICBzdHVkZW50X2lkOiBzdHVkZW50SWQsXG4gICAgaXNfc3R1ZGVudF9yZWNvcmQ6IHRydWUsXG4gICAgY29tcGxpYW5jZV9mbGFnczogWydGRVJQQSddLFxuICAgIHJpc2tfbGV2ZWw6ICdoaWdoJyxcbiAgICAuLi5jbGllbnRJbmZvLFxuICAgIG1ldGFkYXRhLFxuICB9KTtcbn1cblxuLyoqXG4gKiBMb2cgcGFyZW50YWwgY29uc2VudCBhY3Rpb24gKENPUFBBIGNvbXBsaWFuY2UpXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dDb25zZW50QWN0aW9uKFxuICB1c2VySWQ6IHN0cmluZyxcbiAgc3R1ZGVudElkOiBzdHJpbmcsXG4gIGNvbnNlbnRJZDogc3RyaW5nLFxuICBhY3Rpb246IHN0cmluZyxcbiAgY29uc2VudFR5cGU6IHN0cmluZyxcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pIHtcbiAgY29uc3QgY2xpZW50SW5mbyA9IGdldENsaWVudEluZm8oKTtcblxuICByZXR1cm4gbG9nQXVkaXRFdmVudCh7XG4gICAgdXNlcl9pZDogdXNlcklkLFxuICAgIGV2ZW50X3R5cGU6ICdDT05TRU5UJyxcbiAgICBldmVudF9jYXRlZ29yeTogJ0NPTVBMSUFOQ0UnLFxuICAgIHJlc291cmNlX3R5cGU6ICdwYXJlbnRhbF9jb25zZW50JyxcbiAgICByZXNvdXJjZV9pZDogY29uc2VudElkLFxuICAgIGFjdGlvbixcbiAgICBzdHVkZW50X2lkOiBzdHVkZW50SWQsXG4gICAgcGFyZW50YWxfY29uc2VudF9pZDogY29uc2VudElkLFxuICAgIGNvbXBsaWFuY2VfZmxhZ3M6IFsnQ09QUEEnLCAnRkVSUEEnXSxcbiAgICByaXNrX2xldmVsOiAnbWVkaXVtJyxcbiAgICAuLi5jbGllbnRJbmZvLFxuICAgIG1ldGFkYXRhOiB7IGNvbnNlbnRfdHlwZTogY29uc2VudFR5cGUsIC4uLm1ldGFkYXRhIH0sXG4gIH0pO1xufVxuXG4vKipcbiAqIExvZyBkYXRhIGV4cG9ydCAoaGlnaC1yaXNrIGV2ZW50KVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gbG9nRGF0YUV4cG9ydChcbiAgdXNlcklkOiBzdHJpbmcsXG4gIHJlc291cmNlVHlwZTogc3RyaW5nLFxuICBleHBvcnRGb3JtYXQ6IHN0cmluZyxcbiAgcmVjb3JkQ291bnQ6IG51bWJlcixcbiAgbWV0YWRhdGE/OiBSZWNvcmQ8c3RyaW5nLCBhbnk+XG4pIHtcbiAgY29uc3QgY2xpZW50SW5mbyA9IGdldENsaWVudEluZm8oKTtcblxuICByZXR1cm4gbG9nQXVkaXRFdmVudCh7XG4gICAgdXNlcl9pZDogdXNlcklkLFxuICAgIGV2ZW50X3R5cGU6ICdFWFBPUlQnLFxuICAgIGV2ZW50X2NhdGVnb3J5OiAnREFUQScsXG4gICAgcmVzb3VyY2VfdHlwZTogcmVzb3VyY2VUeXBlLFxuICAgIGFjdGlvbjogYEV4cG9ydGVkICR7cmVjb3JkQ291bnR9ICR7cmVzb3VyY2VUeXBlfSByZWNvcmRzIGFzICR7ZXhwb3J0Rm9ybWF0fWAsXG4gICAgcmlza19sZXZlbDogcmVjb3JkQ291bnQgPiAxMDAgPyAnaGlnaCcgOiAnbWVkaXVtJyxcbiAgICAuLi5jbGllbnRJbmZvLFxuICAgIG1ldGFkYXRhOiB7XG4gICAgICBleHBvcnRfZm9ybWF0OiBleHBvcnRGb3JtYXQsXG4gICAgICByZWNvcmRfY291bnQ6IHJlY29yZENvdW50LFxuICAgICAgLi4ubWV0YWRhdGEsXG4gICAgfSxcbiAgfSk7XG59XG5cbi8qKlxuICogTG9nIGNvbmZpZ3VyYXRpb24gY2hhbmdlIChhZG1pbiBhY3Rpb24pXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBsb2dDb25maWdDaGFuZ2UoXG4gIHVzZXJJZDogc3RyaW5nLFxuICByZXNvdXJjZVR5cGU6IHN0cmluZyxcbiAgcmVzb3VyY2VJZDogc3RyaW5nLFxuICBvbGRWYWx1ZXM6IGFueSxcbiAgbmV3VmFsdWVzOiBhbnksXG4gIG1ldGFkYXRhPzogUmVjb3JkPHN0cmluZywgYW55PlxuKSB7XG4gIGNvbnN0IGNsaWVudEluZm8gPSBnZXRDbGllbnRJbmZvKCk7XG5cbiAgLy8gRmlsdGVyIG91dCBhdXRvbWF0aWMgZGF0YWJhc2UgZmllbGRzIHRoYXQgc2hvdWxkbid0IGJlIHNob3duIGluIGF1ZGl0IGxvZ3NcbiAgY29uc3QgYXV0b21hdGljRmllbGRzID0gWyd1cGRhdGVkX2F0JywgJ2NyZWF0ZWRfYXQnLCAnaWQnXTtcbiAgY29uc3QgZmlsdGVyZWRPbGRWYWx1ZXMgPSBvbGRWYWx1ZXMgPyBPYmplY3QuZnJvbUVudHJpZXMoXG4gICAgT2JqZWN0LmVudHJpZXMob2xkVmFsdWVzKS5maWx0ZXIoKFtrZXldKSA9PiAhYXV0b21hdGljRmllbGRzLmluY2x1ZGVzKGtleSkpXG4gICkgOiB1bmRlZmluZWQ7XG4gIGNvbnN0IGZpbHRlcmVkTmV3VmFsdWVzID0gbmV3VmFsdWVzID8gT2JqZWN0LmZyb21FbnRyaWVzKFxuICAgIE9iamVjdC5lbnRyaWVzKG5ld1ZhbHVlcykuZmlsdGVyKChba2V5XSkgPT4gIWF1dG9tYXRpY0ZpZWxkcy5pbmNsdWRlcyhrZXkpKVxuICApIDogdW5kZWZpbmVkO1xuXG4gIHJldHVybiBsb2dBdWRpdEV2ZW50KHtcbiAgICB1c2VyX2lkOiB1c2VySWQsXG4gICAgZXZlbnRfdHlwZTogJ1VQREFURScsXG4gICAgZXZlbnRfY2F0ZWdvcnk6ICdDT05GSUcnLFxuICAgIHJlc291cmNlX3R5cGU6IHJlc291cmNlVHlwZSxcbiAgICByZXNvdXJjZV9pZDogcmVzb3VyY2VJZCxcbiAgICBhY3Rpb246IGBVcGRhdGVkICR7cmVzb3VyY2VUeXBlfSBjb25maWd1cmF0aW9uYCxcbiAgICBvbGRfdmFsdWVzOiBmaWx0ZXJlZE9sZFZhbHVlcyxcbiAgICBuZXdfdmFsdWVzOiBmaWx0ZXJlZE5ld1ZhbHVlcyxcbiAgICByaXNrX2xldmVsOiAnaGlnaCcsXG4gICAgLi4uY2xpZW50SW5mbyxcbiAgICBtZXRhZGF0YSxcbiAgfSk7XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIEFVRElUIFJFVFJJRVZBTFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBhdWRpdCBldmVudHMgd2l0aCBmaWx0ZXJzXG4gKi9cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBnZXRBdWRpdEV2ZW50cyhcbiAgZmlsdGVyczogQXVkaXRGaWx0ZXJzID0ge31cbik6IFByb21pc2U8eyBkYXRhOiBBdWRpdEV2ZW50W107IGVycm9yOiBhbnk7IGNvdW50OiBudW1iZXIgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNsaWVudCA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XG5cbiAgICBsZXQgcXVlcnkgPSBjbGllbnQuZnJvbSgnYXVkaXRfZXZlbnRzJykuc2VsZWN0KCcqJywgeyBjb3VudDogJ2V4YWN0JyB9KTtcblxuICAgIC8vIEFwcGx5IGZpbHRlcnNcbiAgICBpZiAoZmlsdGVycy5kYXRlX2Zyb20pIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZ3RlKCdldmVudF90aW1lc3RhbXAnLCBmaWx0ZXJzLmRhdGVfZnJvbSk7XG4gICAgfVxuICAgIGlmIChmaWx0ZXJzLmRhdGVfdG8pIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubHRlKCdldmVudF90aW1lc3RhbXAnLCBmaWx0ZXJzLmRhdGVfdG8pO1xuICAgIH1cbiAgICBpZiAoZmlsdGVycy51c2VyX2lkcyAmJiBmaWx0ZXJzLnVzZXJfaWRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3VzZXJfaWQnLCBmaWx0ZXJzLnVzZXJfaWRzKTtcbiAgICB9XG4gICAgaWYgKGZpbHRlcnMuc3R1ZGVudF9pZHMgJiYgZmlsdGVycy5zdHVkZW50X2lkcy5sZW5ndGggPiAwKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmluKCdzdHVkZW50X2lkJywgZmlsdGVycy5zdHVkZW50X2lkcyk7XG4gICAgfVxuICAgIGlmIChmaWx0ZXJzLmV2ZW50X3R5cGVzICYmIGZpbHRlcnMuZXZlbnRfdHlwZXMubGVuZ3RoID4gMCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5pbignZXZlbnRfdHlwZScsIGZpbHRlcnMuZXZlbnRfdHlwZXMpO1xuICAgIH1cbiAgICBpZiAoZmlsdGVycy5ldmVudF9jYXRlZ29yaWVzICYmIGZpbHRlcnMuZXZlbnRfY2F0ZWdvcmllcy5sZW5ndGggPiAwKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmluKCdldmVudF9jYXRlZ29yeScsIGZpbHRlcnMuZXZlbnRfY2F0ZWdvcmllcyk7XG4gICAgfVxuICAgIGlmIChmaWx0ZXJzLnJlc291cmNlX3R5cGVzICYmIGZpbHRlcnMucmVzb3VyY2VfdHlwZXMubGVuZ3RoID4gMCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5pbigncmVzb3VyY2VfdHlwZScsIGZpbHRlcnMucmVzb3VyY2VfdHlwZXMpO1xuICAgIH1cbiAgICBpZiAoZmlsdGVycy5yaXNrX2xldmVscyAmJiBmaWx0ZXJzLnJpc2tfbGV2ZWxzLmxlbmd0aCA+IDApIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3Jpc2tfbGV2ZWwnLCBmaWx0ZXJzLnJpc2tfbGV2ZWxzKTtcbiAgICB9XG4gICAgaWYgKGZpbHRlcnMuc3RhdHVzICYmIGZpbHRlcnMuc3RhdHVzLmxlbmd0aCA+IDApIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuaW4oJ3N0YXR1cycsIGZpbHRlcnMuc3RhdHVzKTtcbiAgICB9XG4gICAgaWYgKGZpbHRlcnMuaXNfc3R1ZGVudF9yZWNvcmQgIT09IHVuZGVmaW5lZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnaXNfc3R1ZGVudF9yZWNvcmQnLCBmaWx0ZXJzLmlzX3N0dWRlbnRfcmVjb3JkKTtcbiAgICB9XG4gICAgaWYgKGZpbHRlcnMuaXNfbWlub3JfZGF0YSAhPT0gdW5kZWZpbmVkKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LmVxKCdpc19taW5vcl9kYXRhJywgZmlsdGVycy5pc19taW5vcl9kYXRhKTtcbiAgICB9XG4gICAgaWYgKGZpbHRlcnMuc2VhcmNoKSB7XG4gICAgICBxdWVyeSA9IHF1ZXJ5LnRleHRTZWFyY2goJ3NlYXJjaF92ZWN0b3InLCBmaWx0ZXJzLnNlYXJjaCk7XG4gICAgfVxuXG4gICAgLy8gT3JkZXIgYnkgdGltZXN0YW1wIGRlc2NlbmRpbmdcbiAgICBxdWVyeSA9IHF1ZXJ5Lm9yZGVyKCdldmVudF90aW1lc3RhbXAnLCB7IGFzY2VuZGluZzogZmFsc2UgfSk7XG5cbiAgICAvLyBQYWdpbmF0aW9uXG4gICAgaWYgKGZpbHRlcnMubGltaXQpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubGltaXQoZmlsdGVycy5saW1pdCk7XG4gICAgfVxuICAgIGlmIChmaWx0ZXJzLm9mZnNldCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5yYW5nZShmaWx0ZXJzLm9mZnNldCwgZmlsdGVycy5vZmZzZXQgKyAoZmlsdGVycy5saW1pdCB8fCA1MCkgLSAxKTtcbiAgICB9XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yLCBjb3VudCB9ID0gYXdhaXQgcXVlcnk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF0YTogKGRhdGEgYXMgQXVkaXRFdmVudFtdKSB8fCBbXSxcbiAgICAgIGVycm9yLFxuICAgICAgY291bnQ6IGNvdW50IHx8IDAsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIGF1ZGl0IGV2ZW50czonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgZGF0YTogW10sIGVycm9yLCBjb3VudDogMCB9O1xuICB9XG59XG5cbi8qKlxuICogR2V0IHN0dWRlbnQgcmVjb3JkIGFjY2VzcyBsb2dzIChGRVJQQSB2aWV3KVxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0U3R1ZGVudFJlY29yZEFjY2VzcyhcbiAgc3R1ZGVudElkPzogc3RyaW5nLFxuICBkYXRlRnJvbT86IHN0cmluZyxcbiAgZGF0ZVRvPzogc3RyaW5nXG4pOiBQcm9taXNlPHsgZGF0YTogU3R1ZGVudFJlY29yZEFjY2Vzc1tdOyBlcnJvcjogYW55IH0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjbGllbnQgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xuXG4gICAgbGV0IHF1ZXJ5ID0gY2xpZW50LmZyb20oJ2F1ZGl0X3N0dWRlbnRfcmVjb3JkX2FjY2VzcycpLnNlbGVjdCgnKicpO1xuXG4gICAgaWYgKHN0dWRlbnRJZCkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5lcSgnc3R1ZGVudF9pZCcsIHN0dWRlbnRJZCk7XG4gICAgfVxuICAgIGlmIChkYXRlRnJvbSkge1xuICAgICAgcXVlcnkgPSBxdWVyeS5ndGUoJ2V2ZW50X3RpbWVzdGFtcCcsIGRhdGVGcm9tKTtcbiAgICB9XG4gICAgaWYgKGRhdGVUbykge1xuICAgICAgcXVlcnkgPSBxdWVyeS5sdGUoJ2V2ZW50X3RpbWVzdGFtcCcsIGRhdGVUbyk7XG4gICAgfVxuXG4gICAgcXVlcnkgPSBxdWVyeS5vcmRlcignZXZlbnRfdGltZXN0YW1wJywgeyBhc2NlbmRpbmc6IGZhbHNlIH0pLmxpbWl0KDEwMCk7XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBxdWVyeTtcblxuICAgIHJldHVybiB7XG4gICAgICBkYXRhOiAoZGF0YSBhcyBTdHVkZW50UmVjb3JkQWNjZXNzW10pIHx8IFtdLFxuICAgICAgZXJyb3IsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIHN0dWRlbnQgcmVjb3JkIGFjY2VzczonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgZGF0YTogW10sIGVycm9yIH07XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgZ3JhZGUgY2hhbmdlcyBhdWRpdFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0R3JhZGVDaGFuZ2VzKFxuICBzdHVkZW50SWQ/OiBzdHJpbmcsXG4gIGRhdGVGcm9tPzogc3RyaW5nLFxuICBkYXRlVG8/OiBzdHJpbmdcbik6IFByb21pc2U8eyBkYXRhOiBHcmFkZUNoYW5nZVtdOyBlcnJvcjogYW55IH0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjbGllbnQgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xuXG4gICAgbGV0IHF1ZXJ5ID0gY2xpZW50LmZyb20oJ2F1ZGl0X2dyYWRlX2NoYW5nZXMnKS5zZWxlY3QoJyonKTtcblxuICAgIGlmIChzdHVkZW50SWQpIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZXEoJ3N0dWRlbnRfaWQnLCBzdHVkZW50SWQpO1xuICAgIH1cbiAgICBpZiAoZGF0ZUZyb20pIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkuZ3RlKCdldmVudF90aW1lc3RhbXAnLCBkYXRlRnJvbSk7XG4gICAgfVxuICAgIGlmIChkYXRlVG8pIHtcbiAgICAgIHF1ZXJ5ID0gcXVlcnkubHRlKCdldmVudF90aW1lc3RhbXAnLCBkYXRlVG8pO1xuICAgIH1cblxuICAgIHF1ZXJ5ID0gcXVlcnkub3JkZXIoJ2V2ZW50X3RpbWVzdGFtcCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KS5saW1pdCgxMDApO1xuXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgcXVlcnk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgZGF0YTogKGRhdGEgYXMgR3JhZGVDaGFuZ2VbXSkgfHwgW10sXG4gICAgICBlcnJvcixcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgZ3JhZGUgY2hhbmdlczonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgZGF0YTogW10sIGVycm9yIH07XG4gIH1cbn1cblxuLyoqXG4gKiBHZXQgaGlnaC1yaXNrIGV2ZW50c1xuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0SGlnaFJpc2tFdmVudHMoXG4gIGxpbWl0OiBudW1iZXIgPSA1MFxuKTogUHJvbWlzZTx7IGRhdGE6IEF1ZGl0RXZlbnRbXTsgZXJyb3I6IGFueSB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xpZW50ID0gZ2V0U3VwYWJhc2VDbGllbnQoKTtcblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IGNsaWVudFxuICAgICAgLmZyb20oJ2F1ZGl0X2hpZ2hfcmlza19ldmVudHMnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAub3JkZXIoJ2V2ZW50X3RpbWVzdGFtcCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgLmxpbWl0KGxpbWl0KTtcblxuICAgIHJldHVybiB7XG4gICAgICBkYXRhOiAoZGF0YSBhcyBBdWRpdEV2ZW50W10pIHx8IFtdLFxuICAgICAgZXJyb3IsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIGhpZ2gtcmlzayBldmVudHM6JywgZXJyb3IpO1xuICAgIHJldHVybiB7IGRhdGE6IFtdLCBlcnJvciB9O1xuICB9XG59XG5cbi8qKlxuICogR2V0IGFjdGl2ZSBhbGVydHNcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldEFjdGl2ZUFsZXJ0cygpOiBQcm9taXNlPHsgZGF0YTogQXVkaXRBbGVydFtdOyBlcnJvcjogYW55IH0+IHtcbiAgdHJ5IHtcbiAgICBjb25zdCBjbGllbnQgPSBnZXRTdXBhYmFzZUNsaWVudCgpO1xuXG4gICAgY29uc3QgeyBkYXRhLCBlcnJvciB9ID0gYXdhaXQgY2xpZW50XG4gICAgICAuZnJvbSgnYXVkaXRfYWxlcnRzJylcbiAgICAgIC5zZWxlY3QoJyonKVxuICAgICAgLmluKCdzdGF0dXMnLCBbJ29wZW4nLCAnaW52ZXN0aWdhdGluZyddKVxuICAgICAgLm9yZGVyKCdkZXRlY3RlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBkYXRhOiAoZGF0YSBhcyBBdWRpdEFsZXJ0W10pIHx8IFtdLFxuICAgICAgZXJyb3IsXG4gICAgfTtcbiAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICBjb25zb2xlLmVycm9yKCdFcnJvciBnZXR0aW5nIGFjdGl2ZSBhbGVydHM6JywgZXJyb3IpO1xuICAgIHJldHVybiB7IGRhdGE6IFtdLCBlcnJvciB9O1xuICB9XG59XG5cbi8vID09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT1cbi8vIFBBUkVOVEFMIENPTlNFTlQgTUFOQUdFTUVOVFxuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIEdldCBwYXJlbnRhbCBjb25zZW50IGZvciBhIHN0dWRlbnRcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGdldFBhcmVudGFsQ29uc2VudChcbiAgc3R1ZGVudElkOiBzdHJpbmdcbik6IFByb21pc2U8eyBkYXRhOiBQYXJlbnRhbENvbnNlbnRbXTsgZXJyb3I6IGFueSB9PiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xpZW50ID0gZ2V0U3VwYWJhc2VDbGllbnQoKTtcblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IGNsaWVudFxuICAgICAgLmZyb20oJ3BhcmVudGFsX2NvbnNlbnRfYXVkaXQnKVxuICAgICAgLnNlbGVjdCgnKicpXG4gICAgICAuZXEoJ3N0dWRlbnRfaWQnLCBzdHVkZW50SWQpXG4gICAgICAub3JkZXIoJ3JlcXVlc3RlZF9hdCcsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KTtcblxuICAgIHJldHVybiB7XG4gICAgICBkYXRhOiAoZGF0YSBhcyBQYXJlbnRhbENvbnNlbnRbXSkgfHwgW10sXG4gICAgICBlcnJvcixcbiAgICB9O1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGdldHRpbmcgcGFyZW50YWwgY29uc2VudDonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgZGF0YTogW10sIGVycm9yIH07XG4gIH1cbn1cblxuLyoqXG4gKiBDaGVjayBpZiBzdHVkZW50IGhhcyB2YWxpZCBjb25zZW50IGZvciBhIHNwZWNpZmljIHR5cGVcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGhhc1ZhbGlkQ29uc2VudChcbiAgc3R1ZGVudElkOiBzdHJpbmcsXG4gIGNvbnNlbnRUeXBlOiBzdHJpbmdcbik6IFByb21pc2U8Ym9vbGVhbj4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNsaWVudCA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBjbGllbnRcbiAgICAgIC5mcm9tKCdwYXJlbnRhbF9jb25zZW50X2F1ZGl0JylcbiAgICAgIC5zZWxlY3QoJ2lkLCBjb25zZW50X3N0YXR1cywgZXhwaXJlc19hdCcpXG4gICAgICAuZXEoJ3N0dWRlbnRfaWQnLCBzdHVkZW50SWQpXG4gICAgICAuZXEoJ2NvbnNlbnRfdHlwZScsIGNvbnNlbnRUeXBlKVxuICAgICAgLmVxKCdjb25zZW50X3N0YXR1cycsICdncmFudGVkJylcbiAgICAgIC5zaW5nbGUoKTtcblxuICAgIGlmIChlcnJvciB8fCAhZGF0YSkge1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIC8vIENoZWNrIGlmIGV4cGlyZWRcbiAgICBjb25zdCBjb25zZW50RGF0YSA9IGRhdGEgYXMgYW55O1xuICAgIGlmIChjb25zZW50RGF0YS5leHBpcmVzX2F0KSB7XG4gICAgICBjb25zdCBleHBpcnlEYXRlID0gbmV3IERhdGUoY29uc2VudERhdGEuZXhwaXJlc19hdCk7XG4gICAgICBpZiAoZXhwaXJ5RGF0ZSA8IG5ldyBEYXRlKCkpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9IGNhdGNoIChlcnJvcikge1xuICAgIGNvbnNvbGUuZXJyb3IoJ0Vycm9yIGNoZWNraW5nIGNvbnNlbnQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfVxufVxuXG4vLyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4vLyBVVElMSVRZIEZVTkNUSU9OU1xuLy8gPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PVxuXG4vKipcbiAqIFZlcmlmeSBhdWRpdCBjaGFpbiBpbnRlZ3JpdHlcbiAqL1xuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIHZlcmlmeUF1ZGl0Q2hhaW4oXG4gIGRhdGVGcm9tPzogc3RyaW5nLFxuICBkYXRlVG8/OiBzdHJpbmdcbik6IFByb21pc2U8eyBpc1ZhbGlkOiBib29sZWFuOyB0b3RhbEV2ZW50czogbnVtYmVyOyBpbnZhbGlkRXZlbnRzOiBudW1iZXIgfT4ge1xuICB0cnkge1xuICAgIGNvbnN0IGNsaWVudCA9IGdldFN1cGFiYXNlQ2xpZW50KCk7XG5cbiAgICBjb25zdCB7IGRhdGEsIGVycm9yIH0gPSBhd2FpdCBjbGllbnQucnBjKCd2ZXJpZnlfYXVkaXRfY2hhaW4nLCB7XG4gICAgICBwX2RhdGVfZnJvbTogZGF0ZUZyb20gfHwgbmV3IERhdGUoRGF0ZS5ub3coKSAtIDI0ICogNjAgKiA2MCAqIDEwMDApLnRvSVNPU3RyaW5nKCksXG4gICAgICBwX2RhdGVfdG86IGRhdGVUbyB8fCBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgfSBhcyBhbnkpO1xuXG4gICAgaWYgKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciB2ZXJpZnlpbmcgYXVkaXQgY2hhaW46JywgZXJyb3IpO1xuICAgICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIHRvdGFsRXZlbnRzOiAwLCBpbnZhbGlkRXZlbnRzOiAwIH07XG4gICAgfVxuXG4gICAgY29uc3QgcmVzdWx0ID0gZGF0YSBhcyBhbnk7XG4gICAgcmV0dXJuIHtcbiAgICAgIGlzVmFsaWQ6IHJlc3VsdFswXS5pc192YWxpZCxcbiAgICAgIHRvdGFsRXZlbnRzOiByZXN1bHRbMF0udG90YWxfZXZlbnRzLFxuICAgICAgaW52YWxpZEV2ZW50czogcmVzdWx0WzBdLmludmFsaWRfZXZlbnRzLFxuICAgIH07XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXhjZXB0aW9uIHZlcmlmeWluZyBhdWRpdCBjaGFpbjonLCBlcnJvcik7XG4gICAgcmV0dXJuIHsgaXNWYWxpZDogZmFsc2UsIHRvdGFsRXZlbnRzOiAwLCBpbnZhbGlkRXZlbnRzOiAwIH07XG4gIH1cbn1cblxuLyoqXG4gKiBHZW5lcmF0ZSBjb21wbGlhbmNlIHJlcG9ydFxuICovXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2VuZXJhdGVDb21wbGlhbmNlUmVwb3J0KFxuICBmcmFtZXdvcms6IHN0cmluZyxcbiAgZGF0ZUZyb20/OiBzdHJpbmcsXG4gIGRhdGVUbz86IHN0cmluZ1xuKTogUHJvbWlzZTxzdHJpbmcgfCBudWxsPiB7XG4gIHRyeSB7XG4gICAgY29uc3QgY2xpZW50ID0gZ2V0U3VwYWJhc2VDbGllbnQoKTtcblxuICAgIGNvbnN0IHsgZGF0YSwgZXJyb3IgfSA9IGF3YWl0IGNsaWVudC5ycGMoJ2dlbmVyYXRlX2NvbXBsaWFuY2VfcmVwb3J0Jywge1xuICAgICAgcF9mcmFtZXdvcms6IGZyYW1ld29yayxcbiAgICAgIHBfZGF0ZV9mcm9tOiBkYXRlRnJvbSB8fCBuZXcgRGF0ZShEYXRlLm5vdygpIC0gMzAgKiAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLFxuICAgICAgcF9kYXRlX3RvOiBkYXRlVG8gfHwgbmV3IERhdGUoKS50b0lTT1N0cmluZygpLFxuICAgIH0gYXMgYW55KTtcblxuICAgIGlmIChlcnJvcikge1xuICAgICAgY29uc29sZS5lcnJvcignRXJyb3IgZ2VuZXJhdGluZyBjb21wbGlhbmNlIHJlcG9ydDonLCBlcnJvcik7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICByZXR1cm4gZGF0YSBhcyBzdHJpbmc7XG4gIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgY29uc29sZS5lcnJvcignRXhjZXB0aW9uIGdlbmVyYXRpbmcgY29tcGxpYW5jZSByZXBvcnQ6JywgZXJyb3IpO1xuICAgIHJldHVybiBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBjb25zdCBhdWRpdFNlcnZpY2UgPSB7XG4gIGxvZ0F1ZGl0RXZlbnQsXG4gIGxvZ0F1dGhFdmVudCxcbiAgbG9nU3R1ZGVudFJlY29yZEFjY2VzcyxcbiAgbG9nR3JhZGVDaGFuZ2UsXG4gIGxvZ0NvbnNlbnRBY3Rpb24sXG4gIGxvZ0RhdGFFeHBvcnQsXG4gIGxvZ0NvbmZpZ0NoYW5nZSxcbiAgZ2V0QXVkaXRFdmVudHMsXG4gIGdldFN0dWRlbnRSZWNvcmRBY2Nlc3MsXG4gIGdldEdyYWRlQ2hhbmdlcyxcbiAgZ2V0SGlnaFJpc2tFdmVudHMsXG4gIGdldEFjdGl2ZUFsZXJ0cyxcbiAgZ2V0UGFyZW50YWxDb25zZW50LFxuICBoYXNWYWxpZENvbnNlbnQsXG4gIHZlcmlmeUF1ZGl0Q2hhaW4sXG4gIGdlbmVyYXRlQ29tcGxpYW5jZVJlcG9ydCxcbiAgZ2V0Q2xpZW50SW5mbyxcbiAgZ2VuZXJhdGVTZXNzaW9uSWQsXG59O1xuXG5leHBvcnQgZGVmYXVsdCBhdWRpdFNlcnZpY2U7XG4iXSwibmFtZXMiOlsiY3JlYXRlQ2xpZW50Iiwic3VwYWJhc2VVcmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic3VwYWJhc2VTZXJ2aWNlS2V5IiwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSIsInN1cGFiYXNlIiwiZ2V0U3VwYWJhc2VDbGllbnQiLCJhdXRoIiwiYXV0b1JlZnJlc2hUb2tlbiIsInBlcnNpc3RTZXNzaW9uIiwibG9nQXVkaXRFdmVudCIsInBhcmFtcyIsImNsaWVudCIsImRhdGEiLCJlcnJvciIsInJwYyIsInBfdXNlcl9pZCIsInVzZXJfaWQiLCJwX2V2ZW50X3R5cGUiLCJldmVudF90eXBlIiwicF9ldmVudF9jYXRlZ29yeSIsImV2ZW50X2NhdGVnb3J5IiwicF9yZXNvdXJjZV90eXBlIiwicmVzb3VyY2VfdHlwZSIsInBfcmVzb3VyY2VfaWQiLCJyZXNvdXJjZV9pZCIsInBfcmVzb3VyY2VfbmFtZSIsInJlc291cmNlX25hbWUiLCJwX2FjdGlvbiIsImFjdGlvbiIsInBfZGVzY3JpcHRpb24iLCJkZXNjcmlwdGlvbiIsInBfb2xkX3ZhbHVlcyIsIm9sZF92YWx1ZXMiLCJwX25ld192YWx1ZXMiLCJuZXdfdmFsdWVzIiwicF9zZXNzaW9uX2lkIiwic2Vzc2lvbl9pZCIsInBfaXBfYWRkcmVzcyIsImlwX2FkZHJlc3MiLCJwX3VzZXJfYWdlbnQiLCJ1c2VyX2FnZW50IiwicF9zdGF0dXMiLCJzdGF0dXMiLCJwX3Jpc2tfbGV2ZWwiLCJyaXNrX2xldmVsIiwicF9tZXRhZGF0YSIsIm1ldGFkYXRhIiwiY29uc29sZSIsImdldENsaWVudEluZm8iLCJyZXEiLCJ1c2VyQWdlbnQiLCJuYXZpZ2F0b3IiLCJmb3J3YXJkZWQiLCJoZWFkZXJzIiwiZ2V0IiwiaXAiLCJzcGxpdCIsInVuZGVmaW5lZCIsImdlbmVyYXRlU2Vzc2lvbklkIiwiRGF0ZSIsIm5vdyIsIk1hdGgiLCJyYW5kb20iLCJ0b1N0cmluZyIsInN1YnN0cmluZyIsImxvZ0F1dGhFdmVudCIsInVzZXJJZCIsImNsaWVudEluZm8iLCJyZXBsYWNlIiwibG9nU3R1ZGVudFJlY29yZEFjY2VzcyIsInN0dWRlbnRJZCIsInJlc291cmNlVHlwZSIsInJlc291cmNlSWQiLCJzdHVkZW50X2lkIiwiaXNfc3R1ZGVudF9yZWNvcmQiLCJjb21wbGlhbmNlX2ZsYWdzIiwibG9nR3JhZGVDaGFuZ2UiLCJncmFkZUlkIiwib2xkR3JhZGUiLCJuZXdHcmFkZSIsImxvZ0NvbnNlbnRBY3Rpb24iLCJjb25zZW50SWQiLCJjb25zZW50VHlwZSIsInBhcmVudGFsX2NvbnNlbnRfaWQiLCJjb25zZW50X3R5cGUiLCJsb2dEYXRhRXhwb3J0IiwiZXhwb3J0Rm9ybWF0IiwicmVjb3JkQ291bnQiLCJleHBvcnRfZm9ybWF0IiwicmVjb3JkX2NvdW50IiwibG9nQ29uZmlnQ2hhbmdlIiwib2xkVmFsdWVzIiwibmV3VmFsdWVzIiwiYXV0b21hdGljRmllbGRzIiwiZmlsdGVyZWRPbGRWYWx1ZXMiLCJPYmplY3QiLCJmcm9tRW50cmllcyIsImVudHJpZXMiLCJmaWx0ZXIiLCJrZXkiLCJpbmNsdWRlcyIsImZpbHRlcmVkTmV3VmFsdWVzIiwiZ2V0QXVkaXRFdmVudHMiLCJmaWx0ZXJzIiwicXVlcnkiLCJmcm9tIiwic2VsZWN0IiwiY291bnQiLCJkYXRlX2Zyb20iLCJndGUiLCJkYXRlX3RvIiwibHRlIiwidXNlcl9pZHMiLCJsZW5ndGgiLCJpbiIsInN0dWRlbnRfaWRzIiwiZXZlbnRfdHlwZXMiLCJldmVudF9jYXRlZ29yaWVzIiwicmVzb3VyY2VfdHlwZXMiLCJyaXNrX2xldmVscyIsImVxIiwiaXNfbWlub3JfZGF0YSIsInNlYXJjaCIsInRleHRTZWFyY2giLCJvcmRlciIsImFzY2VuZGluZyIsImxpbWl0Iiwib2Zmc2V0IiwicmFuZ2UiLCJnZXRTdHVkZW50UmVjb3JkQWNjZXNzIiwiZGF0ZUZyb20iLCJkYXRlVG8iLCJnZXRHcmFkZUNoYW5nZXMiLCJnZXRIaWdoUmlza0V2ZW50cyIsImdldEFjdGl2ZUFsZXJ0cyIsImdldFBhcmVudGFsQ29uc2VudCIsImhhc1ZhbGlkQ29uc2VudCIsInNpbmdsZSIsImNvbnNlbnREYXRhIiwiZXhwaXJlc19hdCIsImV4cGlyeURhdGUiLCJ2ZXJpZnlBdWRpdENoYWluIiwicF9kYXRlX2Zyb20iLCJ0b0lTT1N0cmluZyIsInBfZGF0ZV90byIsImlzVmFsaWQiLCJ0b3RhbEV2ZW50cyIsImludmFsaWRFdmVudHMiLCJyZXN1bHQiLCJpc192YWxpZCIsInRvdGFsX2V2ZW50cyIsImludmFsaWRfZXZlbnRzIiwiZ2VuZXJhdGVDb21wbGlhbmNlUmVwb3J0IiwiZnJhbWV3b3JrIiwicF9mcmFtZXdvcmsiLCJhdWRpdFNlcnZpY2UiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/audit/auditService.ts\n");

/***/ }),

/***/ "(rsc)/./src/lib/supabase/server.ts":
/*!************************************!*\
  !*** ./src/lib/supabase/server.ts ***!
  \************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   createAdminClient: () => (/* binding */ createAdminClient),\n/* harmony export */   createClient: () => (/* binding */ createClient)\n/* harmony export */ });\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _supabase_ssr__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @supabase/ssr */ \"(rsc)/./node_modules/@supabase/ssr/dist/module/index.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n\n\n\n// Regular authenticated client (subject to RLS)\nasync function createClient() {\n    const cookieStore = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.cookies)();\n    const client = (0,_supabase_ssr__WEBPACK_IMPORTED_MODULE_1__.createServerClient)(\"https://dgdondsvtqbqnsecbayx.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImRnZG9uZHN2dHFicW5zZWNiYXl4Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjIyNjQ3ODIsImV4cCI6MjA3Nzg0MDc4Mn0.vJCiJGwPGhy_q7avgMnsjihi4i1a7GFUwoGv3Go-9c0\", {\n        cookies: {\n            get (name) {\n                return cookieStore.get(name)?.value;\n            },\n            set (name, value, options) {\n                try {\n                    cookieStore.set({\n                        name,\n                        value,\n                        ...options\n                    });\n                } catch (error) {\n                // The `set` method was called from a Server Component.\n                // This can be ignored if you have middleware refreshing\n                // user sessions.\n                }\n            },\n            remove (name, options) {\n                try {\n                    cookieStore.set({\n                        name,\n                        value: \"\",\n                        ...options\n                    });\n                } catch (error) {\n                // The `delete` method was called from a Server Component.\n                // This can be ignored if you have middleware refreshing\n                // user sessions.\n                }\n            }\n        }\n    });\n    // Set tenant context if multitenancy is enabled\n    if (true) {\n        try {\n            const headersList = await (0,next_headers__WEBPACK_IMPORTED_MODULE_0__.headers)();\n            const tenantSlug = headersList.get(\"x-tenant-slug\");\n            if (tenantSlug) {\n                // Get tenant ID from slug\n                const { data: tenant } = await client.rpc(\"get_tenant_by_slug\", {\n                    p_slug: tenantSlug\n                }).single();\n                const typedTenant = tenant;\n                if (typedTenant?.id) {\n                    // Set current tenant in database session\n                    await client.rpc(\"set_current_tenant\", {\n                        p_tenant_id: typedTenant.id\n                    });\n                }\n            }\n        } catch (error) {\n            console.error(\"Error setting tenant context:\", error);\n        // Don't fail the request, just log the error\n        }\n    }\n    return client;\n}\n// Admin client with service role (bypasses RLS)\n// Use this for admin operations that need to bypass RLS policies\nfunction createAdminClient() {\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_2__.createClient)(\"https://dgdondsvtqbqnsecbayx.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY, {\n        auth: {\n            autoRefreshToken: false,\n            persistSession: false\n        }\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9zcmMvbGliL3N1cGFiYXNlL3NlcnZlci50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7OztBQUFnRDtBQUN1QjtBQUNNO0FBRTdFLGdEQUFnRDtBQUN6QyxlQUFlRztJQUNwQixNQUFNRSxjQUFjLE1BQU1MLHFEQUFPQTtJQUVqQyxNQUFNTSxTQUFTSixpRUFBa0JBLENBQy9CSywwQ0FBb0MsRUFDcENBLGtOQUF5QyxFQUN6QztRQUNFUCxTQUFTO1lBQ1BXLEtBQUlDLElBQVk7Z0JBQ2QsT0FBT1AsWUFBWU0sR0FBRyxDQUFDQyxPQUFPQztZQUNoQztZQUNBQyxLQUFJRixJQUFZLEVBQUVDLEtBQWEsRUFBRUUsT0FBc0I7Z0JBQ3JELElBQUk7b0JBQ0ZWLFlBQVlTLEdBQUcsQ0FBQzt3QkFBRUY7d0JBQU1DO3dCQUFPLEdBQUdFLE9BQU87b0JBQUM7Z0JBQzVDLEVBQUUsT0FBT0MsT0FBTztnQkFDZCx1REFBdUQ7Z0JBQ3ZELHdEQUF3RDtnQkFDeEQsaUJBQWlCO2dCQUNuQjtZQUNGO1lBQ0FDLFFBQU9MLElBQVksRUFBRUcsT0FBc0I7Z0JBQ3pDLElBQUk7b0JBQ0ZWLFlBQVlTLEdBQUcsQ0FBQzt3QkFBRUY7d0JBQU1DLE9BQU87d0JBQUksR0FBR0UsT0FBTztvQkFBQztnQkFDaEQsRUFBRSxPQUFPQyxPQUFPO2dCQUNkLDBEQUEwRDtnQkFDMUQsd0RBQXdEO2dCQUN4RCxpQkFBaUI7Z0JBQ25CO1lBQ0Y7UUFDRjtJQUNGO0lBR0YsZ0RBQWdEO0lBQ2hELElBQUlULElBQWlELEVBQVE7UUFDM0QsSUFBSTtZQUNGLE1BQU1ZLGNBQWMsTUFBTWxCLHFEQUFPQTtZQUNqQyxNQUFNbUIsYUFBYUQsWUFBWVIsR0FBRyxDQUFDO1lBRW5DLElBQUlTLFlBQVk7Z0JBQ2QsMEJBQTBCO2dCQUMxQixNQUFNLEVBQUVDLE1BQU1DLE1BQU0sRUFBRSxHQUFHLE1BQU1oQixPQUM1QmlCLEdBQUcsQ0FBQyxzQkFBc0I7b0JBQUVDLFFBQVFKO2dCQUFXLEdBQy9DSyxNQUFNO2dCQUVULE1BQU1DLGNBQWNKO2dCQUNwQixJQUFJSSxhQUFhQyxJQUFJO29CQUNuQix5Q0FBeUM7b0JBQ3pDLE1BQU1yQixPQUFPaUIsR0FBRyxDQUFDLHNCQUFzQjt3QkFBRUssYUFBYUYsWUFBWUMsRUFBRTtvQkFBQztnQkFDdkU7WUFDRjtRQUNGLEVBQUUsT0FBT1gsT0FBTztZQUNkYSxRQUFRYixLQUFLLENBQUMsaUNBQWlDQTtRQUMvQyw2Q0FBNkM7UUFDL0M7SUFDRjtJQUVBLE9BQU9WO0FBQ1Q7QUFFQSxnREFBZ0Q7QUFDaEQsaUVBQWlFO0FBQzFELFNBQVN3QjtJQUNkLE9BQU8xQixtRUFBb0JBLENBQ3pCRywwQ0FBb0MsRUFDcENBLFFBQVFDLEdBQUcsQ0FBQ3VCLHlCQUF5QixFQUNyQztRQUNFQyxNQUFNO1lBQ0pDLGtCQUFrQjtZQUNsQkMsZ0JBQWdCO1FBQ2xCO0lBQ0Y7QUFFSiIsInNvdXJjZXMiOlsid2VicGFjazovL3BhcmVudGluZy1zY2hvb2wtcGxhdGZvcm0vLi9zcmMvbGliL3N1cGFiYXNlL3NlcnZlci50cz8yZThlIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7IGNvb2tpZXMsIGhlYWRlcnMgfSBmcm9tICduZXh0L2hlYWRlcnMnO1xuaW1wb3J0IHsgY3JlYXRlU2VydmVyQ2xpZW50LCB0eXBlIENvb2tpZU9wdGlvbnMgfSBmcm9tICdAc3VwYWJhc2Uvc3NyJztcbmltcG9ydCB7IGNyZWF0ZUNsaWVudCBhcyBjcmVhdGVTdXBhYmFzZUNsaWVudCB9IGZyb20gJ0BzdXBhYmFzZS9zdXBhYmFzZS1qcyc7XG5cbi8vIFJlZ3VsYXIgYXV0aGVudGljYXRlZCBjbGllbnQgKHN1YmplY3QgdG8gUkxTKVxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNyZWF0ZUNsaWVudCgpIHtcbiAgY29uc3QgY29va2llU3RvcmUgPSBhd2FpdCBjb29raWVzKCk7XG5cbiAgY29uc3QgY2xpZW50ID0gY3JlYXRlU2VydmVyQ2xpZW50KFxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgcHJvY2Vzcy5lbnYuTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkhLFxuICAgIHtcbiAgICAgIGNvb2tpZXM6IHtcbiAgICAgICAgZ2V0KG5hbWU6IHN0cmluZykge1xuICAgICAgICAgIHJldHVybiBjb29raWVTdG9yZS5nZXQobmFtZSk/LnZhbHVlO1xuICAgICAgICB9LFxuICAgICAgICBzZXQobmFtZTogc3RyaW5nLCB2YWx1ZTogc3RyaW5nLCBvcHRpb25zOiBDb29raWVPcHRpb25zKSB7XG4gICAgICAgICAgdHJ5IHtcbiAgICAgICAgICAgIGNvb2tpZVN0b3JlLnNldCh7IG5hbWUsIHZhbHVlLCAuLi5vcHRpb25zIH0pO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBUaGUgYHNldGAgbWV0aG9kIHdhcyBjYWxsZWQgZnJvbSBhIFNlcnZlciBDb21wb25lbnQuXG4gICAgICAgICAgICAvLyBUaGlzIGNhbiBiZSBpZ25vcmVkIGlmIHlvdSBoYXZlIG1pZGRsZXdhcmUgcmVmcmVzaGluZ1xuICAgICAgICAgICAgLy8gdXNlciBzZXNzaW9ucy5cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICAgIHJlbW92ZShuYW1lOiBzdHJpbmcsIG9wdGlvbnM6IENvb2tpZU9wdGlvbnMpIHtcbiAgICAgICAgICB0cnkge1xuICAgICAgICAgICAgY29va2llU3RvcmUuc2V0KHsgbmFtZSwgdmFsdWU6ICcnLCAuLi5vcHRpb25zIH0pO1xuICAgICAgICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICAgICAgICAvLyBUaGUgYGRlbGV0ZWAgbWV0aG9kIHdhcyBjYWxsZWQgZnJvbSBhIFNlcnZlciBDb21wb25lbnQuXG4gICAgICAgICAgICAvLyBUaGlzIGNhbiBiZSBpZ25vcmVkIGlmIHlvdSBoYXZlIG1pZGRsZXdhcmUgcmVmcmVzaGluZ1xuICAgICAgICAgICAgLy8gdXNlciBzZXNzaW9ucy5cbiAgICAgICAgICB9XG4gICAgICAgIH0sXG4gICAgICB9LFxuICAgIH1cbiAgKTtcblxuICAvLyBTZXQgdGVuYW50IGNvbnRleHQgaWYgbXVsdGl0ZW5hbmN5IGlzIGVuYWJsZWRcbiAgaWYgKHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX01VTFRJVEVOQU5DWV9FTkFCTEVEID09PSAndHJ1ZScpIHtcbiAgICB0cnkge1xuICAgICAgY29uc3QgaGVhZGVyc0xpc3QgPSBhd2FpdCBoZWFkZXJzKCk7XG4gICAgICBjb25zdCB0ZW5hbnRTbHVnID0gaGVhZGVyc0xpc3QuZ2V0KCd4LXRlbmFudC1zbHVnJyk7XG5cbiAgICAgIGlmICh0ZW5hbnRTbHVnKSB7XG4gICAgICAgIC8vIEdldCB0ZW5hbnQgSUQgZnJvbSBzbHVnXG4gICAgICAgIGNvbnN0IHsgZGF0YTogdGVuYW50IH0gPSBhd2FpdCBjbGllbnRcbiAgICAgICAgICAucnBjKCdnZXRfdGVuYW50X2J5X3NsdWcnLCB7IHBfc2x1ZzogdGVuYW50U2x1ZyB9KVxuICAgICAgICAgIC5zaW5nbGUoKTtcblxuICAgICAgICBjb25zdCB0eXBlZFRlbmFudCA9IHRlbmFudCBhcyB7IGlkOiBzdHJpbmc7IHNsdWc6IHN0cmluZzsgbmFtZTogc3RyaW5nIH0gfCBudWxsO1xuICAgICAgICBpZiAodHlwZWRUZW5hbnQ/LmlkKSB7XG4gICAgICAgICAgLy8gU2V0IGN1cnJlbnQgdGVuYW50IGluIGRhdGFiYXNlIHNlc3Npb25cbiAgICAgICAgICBhd2FpdCBjbGllbnQucnBjKCdzZXRfY3VycmVudF90ZW5hbnQnLCB7IHBfdGVuYW50X2lkOiB0eXBlZFRlbmFudC5pZCB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmVycm9yKCdFcnJvciBzZXR0aW5nIHRlbmFudCBjb250ZXh0OicsIGVycm9yKTtcbiAgICAgIC8vIERvbid0IGZhaWwgdGhlIHJlcXVlc3QsIGp1c3QgbG9nIHRoZSBlcnJvclxuICAgIH1cbiAgfVxuXG4gIHJldHVybiBjbGllbnQ7XG59XG5cbi8vIEFkbWluIGNsaWVudCB3aXRoIHNlcnZpY2Ugcm9sZSAoYnlwYXNzZXMgUkxTKVxuLy8gVXNlIHRoaXMgZm9yIGFkbWluIG9wZXJhdGlvbnMgdGhhdCBuZWVkIHRvIGJ5cGFzcyBSTFMgcG9saWNpZXNcbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVBZG1pbkNsaWVudCgpIHtcbiAgcmV0dXJuIGNyZWF0ZVN1cGFiYXNlQ2xpZW50KFxuICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSEsXG4gICAge1xuICAgICAgYXV0aDoge1xuICAgICAgICBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSxcbiAgICAgICAgcGVyc2lzdFNlc3Npb246IGZhbHNlXG4gICAgICB9XG4gICAgfVxuICApO1xufSJdLCJuYW1lcyI6WyJjb29raWVzIiwiaGVhZGVycyIsImNyZWF0ZVNlcnZlckNsaWVudCIsImNyZWF0ZUNsaWVudCIsImNyZWF0ZVN1cGFiYXNlQ2xpZW50IiwiY29va2llU3RvcmUiLCJjbGllbnQiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfQU5PTl9LRVkiLCJnZXQiLCJuYW1lIiwidmFsdWUiLCJzZXQiLCJvcHRpb25zIiwiZXJyb3IiLCJyZW1vdmUiLCJORVhUX1BVQkxJQ19NVUxUSVRFTkFOQ1lfRU5BQkxFRCIsImhlYWRlcnNMaXN0IiwidGVuYW50U2x1ZyIsImRhdGEiLCJ0ZW5hbnQiLCJycGMiLCJwX3NsdWciLCJzaW5nbGUiLCJ0eXBlZFRlbmFudCIsImlkIiwicF90ZW5hbnRfaWQiLCJjb25zb2xlIiwiY3JlYXRlQWRtaW5DbGllbnQiLCJTVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZIiwiYXV0aCIsImF1dG9SZWZyZXNoVG9rZW4iLCJwZXJzaXN0U2Vzc2lvbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./src/lib/supabase/server.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/@supabase","vendor-chunks/next","vendor-chunks/tslib","vendor-chunks/cookie"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fadmin%2Fsettings%2Froute&page=%2Fapi%2Fadmin%2Fsettings%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fadmin%2Fsettings%2Froute.ts&appDir=C%3A%5CUsers%5COffirOmer%5CDocuments%5CIPSPlatform%5Csrc%5Capp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=C%3A%5CUsers%5COffirOmer%5CDocuments%5CIPSPlatform&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();