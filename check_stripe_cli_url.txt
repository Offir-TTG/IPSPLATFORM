To diagnose the webhook issue, please run these commands:

1. Check what URL Stripe CLI is forwarding to:
   stripe listen --print-secret

   OR if already running, check the terminal where you started Stripe CLI.
   The command should look like:
   stripe listen --forward-to http://localhost:3000/api/webhooks/stripe

2. Verify the webhook endpoint is accessible:
   curl -X GET http://localhost:3000/api/webhooks/stripe

   This should return webhook configuration info.

3. Check server logs when webhook arrives:
   - Look for logs starting with "[Webhook]" when payment_intent.succeeded arrives
   - If you see no logs, the webhook isn't reaching the endpoint

4. Test webhook manually:
   stripe trigger payment_intent.succeeded

   Then check server logs and database to see if it updates.

The issue is likely:
- Stripe CLI is forwarding to wrong URL (e.g., wrong port or path)
- The Next.js server isn't running when webhooks arrive
- The webhook endpoint URL in Stripe CLI doesn't match the actual route
